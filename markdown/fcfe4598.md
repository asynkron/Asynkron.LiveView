# ğŸ“‹ Feature 1302443 Planning Summary
## Spectre Event Receiver - REST API Gateway for Guidewire Webhooks

---

## ğŸ¯ Overview
**Central Event Ingestion Point** for Guidewire (ifwire) webhooks - simplifying administration, improving performance, and enabling rapid development.

**Status:** Active | **Priority:** 2 | **Iteration:** 25.3 Supersprint  
**Assigned:** Roger Johansson | **Designer:** Sebastian Nilsson

---

## ğŸ’¼ Business Value

### Key Benefits
1. **ğŸ”§ Admin Simplification** - Single endpoint vs. multiple per message type Ã— environment
2. **âš¡ Performance** - Resolves current webhook performance issues in Guidewire
3. **ğŸš€ Rapid Development** - Add Spectre functionality without Guidewire changes
4. **ğŸ¯ Centralization** - Single scalable entry point
5. **ğŸ”® Future-Proof** - Easy integration of new event sources
6. **ğŸ›¡ï¸ Reliability** - Deduplication and validation prevent errors

---

## ğŸ—ï¸ Architecture Highlights

### Technology Stack
- **Application:** ASP.NET Web API
- **Message Queue:** Azure Service Bus (FIFO)
- **Storage:** Azure Storage Account (with retention)
- **API Gateway:** Azure API Management
- **IaC:** Terraform
- **Authentication:** OAuth 2.0

### Key Design Decisions
âœ… New repository (future Spectre monorepo)  
âœ… Separate endpoint per Guidewire xCenter  
âœ… Clear code separation per message type  
âœ… FIFO queue maintains Guidewire order  
âœ… Message compression using .NET standard  

---

## ğŸ“ Core Requirements

### 1ï¸âƒ£ API Functionality
- âœ… Accept webhooks from Guidewire
- âœ… Separate endpoints per xCenter
- âœ… Return 202 for valid, 4xx for invalid
- âœ… Guidewire handles retries

### 2ï¸âƒ£ Validation & Deduplication
- âœ… Reject duplicate event IDs
- âœ… Only predefined event types accepted
- âœ… Schema validation

### 3ï¸âƒ£ Security
- âœ… OAuth authentication enforced
- âœ… Encryption at rest (Azure Service Bus)
- âœ… Full message traceability with retention
- âœ… No PII/sensitive data in logs (GDPR)

### 4ï¸âƒ£ Performance
- âœ… Meet Spectre SLOs (uptime, response time, error rate)
- âœ… HTTP header-based early filtering
- âœ… Lazy JSON body reading
- âœ… Message compression/decompression

### 5ï¸âƒ£ Error Handling
- âœ… Invalid messages rejected
- âœ… Clear error responses
- âœ… Comprehensive error logging

---

## ğŸ”¨ Implementation Tasks

### Workitem 1324374 - IaC Config (5 pts)
**Owner:** Tommy Ekh | **Status:** New | **Iteration:** 25.3.1

**Deliverables:**
- Terraform templates for all Azure resources
- CI/CD pipeline for Terraform
- Network and security configuration
- Validated in dev environment

**âš ï¸ Blocker:** Need agreement on naming conventions (Tommy's comment)

---

### Workitem 1324394 - ASP.NET Application (5 pts)
**Owner:** Unassigned | **Status:** New | **Iteration:** 25.3 Supersprint

**Deliverables:**
- New Azure DevOps repository
- ASP.NET application with full functionality
- Deployment pipeline
- Deployed to dev environment

---

### Workitem 1324416 - PAP and APIM (3 pts)
**Owner:** Unassigned | **Status:** New | **Iteration:** 25.3.1

**Deliverables:**
- PAP process initiated
- Non-production APIM registration
- Guidewire integration ready

---

## ğŸ”— Parent Context

### Epic 1220953 - Issue Car Insurance Policy
This feature enables the broader goal of allowing **Car Dealers to sell Car Insurance policies**.

**Epic Success Criteria:**
- Car Dealers can convert quotes to policies
- Payment methods supported
- Legal documents delivered
- Direct debit integration
- MTPL certificate registration
- Commission tracking
- GL integration

---

## âš ï¸ Out of Scope

âŒ No transactionality or command handling  
âŒ No message processing/transformation (ingestion only)  
âŒ No consumer implementation  
âŒ No additional compliance integration  

---

## ğŸª Message Flow

```
Guidewire Webhook
    â†“
OAuth Validation
    â†“
HTTP Header Check (early filter)
    â†“
JSON Body Parse (lazy)
    â†“
Validation (type, schema, dedup)
    â†“
Store (traceability with retention)
    â†“
Compress
    â†“
Azure Service Bus Topic (FIFO)
    â†“
HTTP 202 Response
```

---

## ğŸ“Š Architecture Components

### Infrastructure (Terraform)
- **App Service** - Hosts ASP.NET API
- **App Service Plan** - Compute resources
- **Service Bus** - Message queuing with topics
- **Storage Account** - Message traceability
- **Network** - Security groups, firewall
- **APIM** - API gateway, OAuth, rate limiting

### Application Structure
```
/EventReceiverApi        # Web API
/EventTypes              # Per-event handlers
  /PolicyCreated
  /PolicyUpdated
  /ClaimCreated
/Validation              # Validation logic
/Storage                 # Message storage
/ServiceBus              # Queue integration
/Authentication          # OAuth handling
```

---

## â“ Open Questions

1. **Naming conventions** - Need agreement (blocks IaC)
2. **Event type catalog** - Complete list of supported events?
3. **Retention period** - How long to keep stored messages?
4. **Throughput targets** - Messages/second requirement?
5. **Azure SKU** - Which App Service tier?
6. **Compression** - GZip or Brotli?
7. **OAuth provider** - Configuration details?
8. **Service Bus** - Topic vs Queue, partitioning?

---

## ğŸš¦ Next Steps

### Immediate (This Week)
1. âœ… Requirements documented
2. â­ï¸ **Resolve naming conventions** (Tommy)
3. â­ï¸ **Finalize Azure SKUs** (Tommy)
4. â­ï¸ **Create repository** (Developer)
5. â­ï¸ **Start Terraform** (Tommy)
6. â­ï¸ **Initiate PAP** (Developer)

### Development Sequence
1. Infrastructure (IaC) 
2. Application scaffold
3. Core API implementation
4. APIM integration
5. Testing & validation
6. Documentation

---

## ğŸ“š References

### Documentation
- [Feature Design (Confluence)](https://confluence.ifint.biz/spaces/MNC/pages/375593997/Feature+1302443)
- [ADR-015: Event Receiver Architecture](https://confluence.ifint.biz/spaces/MNC/pages/364143842/CTP-ADR-015+Event+receiver+architecture+in+Spectre)
- [Spectre ADR-015 Details](https://confluence.ifint.biz/spaces/MNC/pages/371852928/Spectre+Details+for+ADR-015)
- [Epic 1220953 Documentation](https://confluence.ifint.biz/spaces/MNC/pages/342700499/Epic+1220953+-+Issue+Car+Insurance+policy)

### Workitems
- [Feature 1302443](https://dev.azure.com/if-it/mobility-CTP/_workitems/edit/1302443) - Main Feature
- [Epic 1220953](https://dev.azure.com/if-it/mobility-CTP/_workitems/edit/1220953) - Parent Epic
- [Story 1324374](https://dev.azure.com/if-it/mobility-CTP/_workitems/edit/1324374) - IaC Config
- [Story 1324394](https://dev.azure.com/if-it/mobility-CTP/_workitems/edit/1324394) - ASP.NET App
- [Story 1324416](https://dev.azure.com/if-it/mobility-CTP/_workitems/edit/1324416) - PAP/APIM

---

## âœ… Success Criteria

### Technical
- âœ… All acceptance criteria met
- âœ… All child workitems completed
- âœ… Deployed and validated in dev
- âœ… APIM registered
- âœ… Performance SLOs met
- âœ… Security requirements satisfied

### Business
- âœ… Admin overhead reduced
- âœ… Performance improved
- âœ… Ready for rapid development
- âœ… Supports policy issuance workflow

---

**Planning Status:** âœ… Complete - Ready for Implementation  
**Full Requirements:** See `requirements.md` in repository
