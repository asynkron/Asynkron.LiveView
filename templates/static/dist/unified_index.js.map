{
  "version": 3,
  "sources": ["../../../frontend/src/js/unified_index.js"],
  "sourcesContent": ["// Client-side bootstrap logic for the unified markdown viewer UI.\nfunction bootstrap() {\n    const state = window.__INITIAL_STATE__ || {};\n    const content = document.getElementById('content');\n    const fileName = document.getElementById('file-name');\n    const sidebarPath = document.getElementById('sidebar-path');\n    const fileList = document.getElementById('file-list');\n    const downloadButton = document.getElementById('download-button');\n    const deleteButton = document.getElementById('delete-button');\n    const editButton = document.getElementById('edit-button');\n    const previewButton = document.getElementById('preview-button');\n    const saveButton = document.getElementById('save-button');\n    const cancelButton = document.getElementById('cancel-button');\n    const editorContainer = document.getElementById('editor-container');\n    const offlineOverlay = document.getElementById('offline-overlay');\n    const unsavedChangesModal = document.getElementById('unsaved-changes-modal');\n    const unsavedChangesFilename = document.getElementById('unsaved-changes-filename');\n    const unsavedChangesMessage = document.getElementById('unsaved-changes-message');\n    const unsavedChangesDetail = document.getElementById('unsaved-changes-detail');\n    const unsavedChangesSaveButton = document.getElementById('unsaved-changes-save');\n    const unsavedChangesDiscardButton = document.getElementById('unsaved-changes-discard');\n    const unsavedChangesCancelButton = document.getElementById('unsaved-changes-cancel');\n    const tocList = document.getElementById('toc-list');\n    const tocSidebar = document.querySelector('.sidebar--toc');\n    const fileSidebar = document.querySelector('.sidebar--files');\n    const tocSplitter = document.getElementById('toc-splitter');\n    const fileSplitter = document.getElementById('file-splitter');\n    const dockviewRoot = document.getElementById('dockview-root');\n    const appShell = document.querySelector('.app-shell');\n    const rootElement = document.documentElement;\n    const viewerSection = document.querySelector('.viewer');\n    const terminalPanel = document.getElementById('terminal-panel');\n    const terminalContainer = document.getElementById('terminal-container');\n    const terminalToggleButton = document.getElementById('terminal-toggle');\n    const terminalStatusText = document.getElementById('terminal-status');\n    const terminalResizeHandle = document.getElementById('terminal-resize-handle');\n    const terminalStorageKey = 'terminalPanelHeight';\n    const panelToggleButtons = Array.from(document.querySelectorAll('[data-panel-toggle]'));\n    const panelToggleButtonMap = new Map();\n    // Persist dockview layout between sessions so panel positions are restored.\n    const dockviewLayoutStorageKey = 'dockviewLayout';\n    const dockviewLayoutSaveDelayMs = 750;\n    let dockviewLayoutSaveTimer = null;\n    let dockviewPointerActive = false;\n\n    panelToggleButtons.forEach((button) => {\n        const panelName = button.dataset.panelToggle;\n        if (!panelName) {\n            return;\n        }\n\n        panelToggleButtonMap.set(panelName, button);\n        button.addEventListener('click', (event) => {\n            event.preventDefault();\n            const currentlyVisible = getPanelVisibility(panelName);\n            const nextVisible = !currentlyVisible;\n            setPanelVisibility(panelName, nextVisible);\n        });\n    });\n\n    if (content) {\n        content.addEventListener('click', handleHeadingActionClick);\n    }\n\n    const initialIndex = normaliseFileIndex({\n        filesValue: state.files,\n        treeValue: state.fileTree,\n    });\n    let currentFile = state.selectedFile || null;\n    let files = initialIndex.files;\n    let fileTree = initialIndex.tree;\n    let websocket = null;\n    let reconnectTimer = null;\n    let isEditing = false;\n    let isPreviewing = false;\n    let editorInstance = null;\n    let draftContent = '';\n    let currentContent = typeof state.content === 'string' ? state.content : '';\n    let hasPendingChanges = false;\n    let suppressEditorChangeEvents = false;\n    let activeUnsavedPrompt = null;\n\n    const originalPathArgument = state.pathArgument || '';\n    let resolvedRootPath = state.rootPath || '';\n    const initialFileFromLocation = fileFromSearch(window.location.search);\n    const textEncoder = new TextEncoder();\n    const textDecoder = new TextDecoder();\n    let markedConfigured = false;\n    let mermaidInitAttempted = false;\n    let mermaidRetryTimer = null;\n    let vegaRetryTimer = null;\n    let excalidrawRetryTimer = null;\n    let mermaidIdCounter = 0;\n    let vegaIdCounter = 0;\n    let excalidrawIdCounter = 0;\n    const excalidrawRoots = new Map();\n    let excalidrawResizeHandlerAttached = false;\n    let excalidrawFitFailureLogged = false;\n    let librariesReadyPromise = null;\n    let pendingMarkdown = null;\n    let relativeLinksEnabled = false;\n    let relativeLinkBasePath = '';\n    let relativeLinkBaseWalker = null;\n    let relativeLinkExtensionRegistered = false;\n    let headingLocationMap = new Map();\n    let headingHighlightLine = null;\n    let headingHighlightTimeout = null;\n    const relativeLinkDummyOrigin = 'http://__dummy__/';\n    const relativeLinkSchemePattern = /^[a-zA-Z][\\w+.-]*:/;\n    const relativeLinkProtocolRelativePattern = /^\\/\\//;\n    const expandedDirectories = new Set();\n    const knownDirectories = new Set();\n    const dockviewSetup = initialiseDockviewLayout();\n    const dockviewIsActive = Boolean(dockviewSetup);\n    document.body.classList.toggle('dockview-active', dockviewIsActive);\n    refreshPanelToggleStates();\n\n    if (dockviewIsActive && dockviewRoot) {\n        dockviewRoot.addEventListener('pointerdown', handleDockviewPointerDown);\n        window.addEventListener('pointerup', handleDockviewPointerFinish);\n        window.addEventListener('pointercancel', handleDockviewPointerFinish);\n    }\n    let activeHeadingCollection = null;\n    let documentSlugCounts = null;\n    let terminalInstance = null;\n    let terminalFitAddon = null;\n    let terminalSocket = null;\n    let terminalReconnectTimer = null;\n    let terminalLibraryRetryTimer = null;\n    let terminalCollapsed = false;\n    let terminalHeight = null;\n    let pendingTerminalFitFrame = null;\n    let terminalResizeObserver = null;\n    const terminalDecoder = new TextDecoder();\n    let terminalLastStatusMessage = '';\n\n    function updatePanelToggleButtonState(name, isVisible) {\n        const button = panelToggleButtonMap.get(name);\n        if (!button) {\n            return;\n        }\n        button.setAttribute('aria-pressed', String(Boolean(isVisible)));\n    }\n\n    function getPanelVisibility(name) {\n        if (dockviewSetup && dockviewSetup.panels && dockviewSetup.panels[name]) {\n            const panel = dockviewSetup.panels[name];\n            const groupApi = panel?.group?.api;\n            if (groupApi && typeof groupApi.isVisible === 'boolean') {\n                return groupApi.isVisible;\n            }\n            return panel?.api?.isVisible ?? true;\n        }\n\n        if (name === 'toc' && tocSidebar) {\n            return !tocSidebar.classList.contains('hidden');\n        }\n\n        if (name === 'files' && fileSidebar) {\n            return !fileSidebar.classList.contains('hidden');\n        }\n\n        return true;\n    }\n\n    function toggleLegacySidebar(name, visible) {\n        const targetSidebar = name === 'toc' ? tocSidebar : name === 'files' ? fileSidebar : null;\n        if (!targetSidebar) {\n            return;\n        }\n\n        targetSidebar.classList.toggle('hidden', !visible);\n        targetSidebar.classList.toggle('is-expanded', visible);\n\n        const widthVar = name === 'toc' ? '--toc-sidebar-current-width' : '--file-sidebar-current-width';\n        const defaultWidth = name === 'toc' ? 'var(--toc-sidebar-width)' : 'var(--file-sidebar-width)';\n\n        rootElement.style.setProperty(\n            widthVar,\n            visible ? defaultWidth : 'var(--sidebar-collapsed-width)'\n        );\n\n        const splitter = name === 'toc' ? tocSplitter : fileSplitter;\n        if (splitter) {\n            splitter.classList.toggle('hidden', !visible);\n        }\n    }\n\n    function setPanelVisibility(name, visible) {\n        if (dockviewSetup && dockviewSetup.panels && dockviewSetup.panels[name]) {\n            const panel = dockviewSetup.panels[name];\n            const groupApi = panel?.group?.api;\n\n            if (groupApi && typeof groupApi.setVisible === 'function') {\n                groupApi.setVisible(visible);\n            } else if (panel?.api && typeof panel.api.setVisible === 'function') {\n                panel.api.setVisible(visible);\n            }\n        } else {\n            toggleLegacySidebar(name, visible);\n        }\n\n        if (name === 'toc' && tocSidebar) {\n            tocSidebar.classList.toggle('is-expanded', visible);\n        } else if (name === 'files' && fileSidebar) {\n            fileSidebar.classList.toggle('is-expanded', visible);\n        }\n\n        updatePanelToggleButtonState(name, visible);\n        window.requestAnimationFrame(() => {\n            updatePanelToggleButtonState(name, getPanelVisibility(name));\n        });\n\n        scheduleDockviewLayoutSave();\n    }\n\n    function refreshPanelToggleStates() {\n        panelToggleButtonMap.forEach((_button, name) => {\n            updatePanelToggleButtonState(name, getPanelVisibility(name));\n        });\n    }\n\n    function restoreDockviewLayout(instance) {\n        if (!instance || typeof window.localStorage === 'undefined') {\n            return false;\n        }\n\n        let rawLayout = null;\n        try {\n            rawLayout = window.localStorage.getItem(dockviewLayoutStorageKey);\n        } catch (storageError) {\n            console.warn('Dockview layout restore skipped: storage unavailable.', storageError);\n            return false;\n        }\n\n        if (!rawLayout) {\n            return false;\n        }\n\n        try {\n            const savedLayout = JSON.parse(rawLayout);\n\n            if (typeof instance.restoreLayout === 'function') {\n                instance.restoreLayout(savedLayout);\n            } else if (typeof instance.fromJSON === 'function') {\n                // Dockview >= 1.12 exposes fromJSON instead of restoreLayout\n                instance.fromJSON(savedLayout);\n            } else {\n                throw new Error('Dockview instance cannot restore layouts');\n            }\n            return true;\n        } catch (error) {\n            console.warn('Failed to restore dockview layout; clearing saved state.', error);\n            try {\n                window.localStorage.removeItem(dockviewLayoutStorageKey);\n            } catch (clearError) {\n                console.warn('Unable to clear saved dockview layout.', clearError);\n            }\n        }\n\n        return false;\n    }\n\n    function persistDockviewLayout() {\n        if (!dockviewSetup?.instance || typeof window.localStorage === 'undefined') {\n            return;\n        }\n\n        try {\n            const { instance } = dockviewSetup;\n            const layoutState = (typeof instance.saveLayout === 'function')\n                ? instance.saveLayout()\n                : (typeof instance.toJSON === 'function')\n                    ? instance.toJSON()\n                    : (() => { throw new Error('Dockview instance cannot serialise layouts'); })();\n            const serialisedLayout = JSON.stringify(layoutState);\n            window.localStorage.setItem(dockviewLayoutStorageKey, serialisedLayout);\n        } catch (error) {\n            console.warn('Failed to persist dockview layout.', error);\n        }\n    }\n\n    function scheduleDockviewLayoutSave() {\n        if (!dockviewSetup?.instance) {\n            return;\n        }\n\n        if (dockviewLayoutSaveTimer) {\n            window.clearTimeout(dockviewLayoutSaveTimer);\n        }\n\n        dockviewLayoutSaveTimer = window.setTimeout(() => {\n            dockviewLayoutSaveTimer = null;\n            persistDockviewLayout();\n        }, dockviewLayoutSaveDelayMs);\n    }\n\n    function handleDockviewPointerDown(event) {\n        if (!dockviewSetup?.instance || !dockviewRoot) {\n            dockviewPointerActive = false;\n            return;\n        }\n\n        dockviewPointerActive = dockviewRoot.contains(event.target);\n    }\n\n    function handleDockviewPointerFinish() {\n        if (!dockviewPointerActive) {\n            return;\n        }\n\n        dockviewPointerActive = false;\n        scheduleDockviewLayoutSave();\n    }\n\n    function initialiseDockviewLayout() {\n        window.__dockviewSetup = null;\n\n        if (!dockviewRoot) {\n            return null;\n        }\n\n        if (!window.dockview || !window.dockview.DockviewComponent) {\n            dockviewRoot.classList.add('hidden');\n            if (appShell) {\n                appShell.classList.remove('hidden');\n            }\n            window.__dockviewSetup = null;\n            return null;\n        }\n\n        if (!viewerSection || !tocSidebar || !fileSidebar || !terminalPanel) {\n            console.warn('Dockview initialisation skipped: missing panel sources.');\n            dockviewRoot.classList.add('hidden');\n            if (appShell) {\n                appShell.classList.remove('hidden');\n            }\n            window.__dockviewSetup = null;\n            return null;\n        }\n\n        if (tocSplitter && tocSplitter.parentElement) {\n            tocSplitter.parentElement.removeChild(tocSplitter);\n        }\n        if (fileSplitter && fileSplitter.parentElement) {\n            fileSplitter.parentElement.removeChild(fileSplitter);\n        }\n\n        const panelSources = {\n            viewer: viewerSection,\n            toc: tocSidebar,\n            files: fileSidebar,\n            terminal: terminalPanel,\n        };\n\n        if (tocSidebar) {\n            tocSidebar.classList.add('is-expanded');\n        }\n\n        if (fileSidebar) {\n            fileSidebar.classList.add('is-expanded');\n        }\n\n        const dockview = new window.dockview.DockviewComponent(dockviewRoot, {\n            hideBorders: true,\n            createComponent({ name }) {\n                const element = document.createElement('div');\n                element.classList.add('dockview-panel-container', `dockview-panel-${name}`);\n\n                const source = panelSources[name];\n                if (source) {\n                    element.appendChild(source);\n                } else {\n                    const placeholder = document.createElement('div');\n                    placeholder.className = 'panel-missing';\n                    placeholder.textContent = `Missing panel: ${name}`;\n                    element.appendChild(placeholder);\n                }\n\n                return {\n                    element,\n                    init() { },\n                    dispose() { },\n                };\n            },\n        });\n\n        const currentViewerTitle = (typeof currentFile === 'string' && currentFile.length)\n            ? currentFile\n            : 'Document';\n\n        const viewerPanel = dockview.addPanel({\n            id: 'dockview-viewer',\n            component: 'viewer',\n            title: currentViewerTitle,\n        });\n\n        const tocPanel = dockview.addPanel({\n            id: 'dockview-toc',\n            component: 'toc',\n            title: 'Table of contents',\n            position: { referencePanel: viewerPanel, direction: 'left' },\n        });\n\n        const filesPanel = dockview.addPanel({\n            id: 'dockview-files',\n            component: 'files',\n            title: 'Files',\n            position: { referencePanel: viewerPanel, direction: 'right' },\n        });\n\n        const terminalDockviewPanel = dockview.addPanel({\n            id: 'dockview-terminal',\n            component: 'terminal',\n            title: 'Terminal',\n            position: { referencePanel: viewerPanel, direction: 'bottom' },\n        });\n\n        dockviewRoot.classList.remove('hidden');\n        if (appShell) {\n            appShell.classList.add('hidden');\n        }\n\n        const setup = {\n            instance: dockview,\n            panels: {\n                viewer: viewerPanel,\n                toc: tocPanel,\n                files: filesPanel,\n                terminal: terminalDockviewPanel,\n            },\n        };\n\n        window.__dockviewSetup = setup;\n\n        restoreDockviewLayout(dockview);\n\n        [\n            ['toc', tocPanel?.group?.api],\n            ['files', filesPanel?.group?.api],\n        ].forEach(([name, api]) => {\n            if (api && typeof api.onDidVisibilityChange === 'function') {\n                api.onDidVisibilityChange(({ isVisible }) => {\n                    updatePanelToggleButtonState(name, isVisible);\n                });\n            }\n        });\n\n        updatePanelToggleButtonState('toc', true);\n        updatePanelToggleButtonState('files', true);\n\n        return setup;\n    }\n\n    function normaliseFileIndex({ filesValue, treeValue }) {\n        let flat = [];\n        let tree = [];\n\n        if (Array.isArray(filesValue)) {\n            flat = filesValue;\n        } else if (filesValue && Array.isArray(filesValue.files)) {\n            flat = filesValue.files;\n            if (Array.isArray(filesValue.tree)) {\n                tree = filesValue.tree;\n            }\n        }\n\n        if (!tree.length && Array.isArray(treeValue)) {\n            tree = treeValue;\n        }\n\n        if (tree.length && !flat.length) {\n            flat = flattenTree(tree);\n        }\n\n        if (!tree.length && flat.length) {\n            tree = buildTreeFromFlatList(flat);\n        }\n\n        return { files: flat, tree };\n    }\n\n    function flattenTree(nodes) {\n        const result = [];\n        if (!Array.isArray(nodes)) {\n            return result;\n        }\n\n        const stack = [...nodes];\n        while (stack.length) {\n            const node = stack.shift();\n            if (!node || typeof node !== 'object') {\n                continue;\n            }\n\n            if (node.type === 'file') {\n                result.push({\n                    name: node.name,\n                    relativePath: node.relativePath,\n                    size: node.size,\n                    updated: node.updated,\n                });\n                continue;\n            }\n\n            if (node.type === 'directory' && Array.isArray(node.children)) {\n                stack.unshift(...node.children);\n            }\n        }\n\n        return result;\n    }\n\n    function buildTreeFromFlatList(flatList) {\n        if (!Array.isArray(flatList) || !flatList.length) {\n            return [];\n        }\n\n        const root = [];\n        const directoryMap = new Map();\n        directoryMap.set('', root);\n\n        function ensureDirectory(path, name) {\n            if (directoryMap.has(path)) {\n                return directoryMap.get(path);\n            }\n\n            const parentPath = path.includes('/') ? path.slice(0, path.lastIndexOf('/')) : '';\n            const parentChildren = directoryMap.get(parentPath) || root;\n            const node = {\n                type: 'directory',\n                name,\n                relativePath: path,\n                children: [],\n            };\n            parentChildren.push(node);\n            directoryMap.set(path, node.children);\n            return node.children;\n        }\n\n        flatList.forEach((file) => {\n            if (!file || typeof file.relativePath !== 'string') {\n                return;\n            }\n\n            const segments = file.relativePath.split('/');\n            const fileName = segments.pop();\n            let currentPath = '';\n            segments.forEach((segment) => {\n                if (!segment) {\n                    return;\n                }\n                currentPath = currentPath ? `${currentPath}/${segment}` : segment;\n                ensureDirectory(currentPath, segment);\n            });\n\n            const parentPath = segments.join('/');\n            const parentChildren = directoryMap.get(parentPath) || root;\n            parentChildren.push({\n                type: 'file',\n                name: fileName,\n                relativePath: file.relativePath,\n                size: file.size,\n                updated: file.updated,\n            });\n        });\n\n        sortTree(root);\n        return root;\n    }\n\n    function sortTree(nodes) {\n        if (!Array.isArray(nodes)) {\n            return;\n        }\n        nodes.sort((a, b) => {\n            if (a.type === b.type) {\n                return String(a.name || '').localeCompare(String(b.name || ''));\n            }\n            return a.type === 'directory' ? -1 : 1;\n        });\n        nodes.forEach((node) => {\n            if (node.type === 'directory') {\n                sortTree(node.children);\n            }\n        });\n    }\n\n    function updateRelativeLinkBase(filePath) {\n        if (typeof filePath !== 'string' || filePath.length === 0) {\n            relativeLinksEnabled = false;\n            relativeLinkBasePath = '';\n            relativeLinkBaseWalker = null;\n            return;\n        }\n\n        relativeLinksEnabled = true;\n        const lastSlashIndex = filePath.lastIndexOf('/');\n        relativeLinkBasePath = lastSlashIndex === -1 ? '' : filePath.slice(0, lastSlashIndex + 1);\n\n        if (typeof markedBaseUrl !== 'undefined' && markedBaseUrl && typeof markedBaseUrl.baseUrl === 'function') {\n            const baseCandidate = relativeLinkBasePath || './';\n            try {\n                relativeLinkBaseWalker = markedBaseUrl.baseUrl(baseCandidate);\n            } catch (error) {\n                console.warn('Failed to initialise marked-base-url', error);\n                relativeLinkBaseWalker = null;\n            }\n        } else {\n            relativeLinkBaseWalker = null;\n        }\n    }\n\n    function decodePathSegments(path) {\n        if (!path) {\n            return '';\n        }\n        return path\n            .split('/')\n            .map((segment) => {\n                try {\n                    return decodeURIComponent(segment);\n                } catch {\n                    return segment;\n                }\n            })\n            .join('/');\n    }\n\n    function encodePathSegments(path) {\n        if (!path) {\n            return '';\n        }\n        return path\n            .split('/')\n            .map((segment) => encodeURIComponent(segment))\n            .join('/');\n    }\n\n    function fallbackResolveRelativeHref(href) {\n        try {\n            const baseReference = relativeLinkBasePath ? relativeLinkBasePath : '.';\n            const baseUrl = new URL(baseReference, relativeLinkDummyOrigin);\n            const resolvedUrl = new URL(href, baseUrl);\n            const normalisedPath = resolvedUrl.pathname.replace(/^\\/+/u, '');\n            const decodedPath = decodePathSegments(normalisedPath);\n            return `${decodedPath}${resolvedUrl.search}${resolvedUrl.hash}`;\n        } catch (error) {\n            console.warn('Relative link fallback failed', error);\n            return href;\n        }\n    }\n\n    function splitResolvedHref(resolvedHref) {\n        if (typeof resolvedHref !== 'string' || resolvedHref.length === 0) {\n            return { filePath: '', search: '', hash: '' };\n        }\n\n        let working = resolvedHref;\n        let hash = '';\n        const hashIndex = working.indexOf('#');\n        if (hashIndex !== -1) {\n            hash = working.slice(hashIndex);\n            working = working.slice(0, hashIndex);\n        }\n\n        let search = '';\n        const searchIndex = working.indexOf('?');\n        if (searchIndex !== -1) {\n            search = working.slice(searchIndex);\n            working = working.slice(0, searchIndex);\n        }\n\n        const cleaned = working.replace(/^\\.\\//, '').replace(/^\\/+/u, '');\n        const filePath = decodePathSegments(cleaned);\n        return { filePath, search, hash };\n    }\n\n    function transformRelativeAsset(rawHref, tokenType) {\n        if (!relativeLinksEnabled || typeof rawHref !== 'string') {\n            return null;\n        }\n\n        const trimmedHref = rawHref.trim();\n        if (\n            !trimmedHref ||\n            trimmedHref.startsWith('#') ||\n            relativeLinkProtocolRelativePattern.test(trimmedHref) ||\n            relativeLinkSchemePattern.test(trimmedHref) ||\n            trimmedHref.startsWith('/')\n        ) {\n            return null;\n        }\n\n        let resolvedHref = trimmedHref;\n        const walker = relativeLinkBaseWalker;\n\n        if (walker && typeof walker.walkTokens === 'function') {\n            const tempToken = { type: tokenType, href: trimmedHref };\n            try {\n                walker.walkTokens(tempToken);\n                resolvedHref = tempToken.href;\n            } catch (error) {\n                console.warn('marked-base-url resolution failed', error);\n                resolvedHref = fallbackResolveRelativeHref(trimmedHref);\n            }\n        } else {\n            resolvedHref = fallbackResolveRelativeHref(trimmedHref);\n        }\n\n        const parts = splitResolvedHref(resolvedHref);\n        if (!parts.filePath) {\n            return null;\n        }\n\n        if (tokenType === 'image') {\n            return {\n                assetHref: `${encodePathSegments(parts.filePath)}${parts.search}${parts.hash}`,\n            };\n        }\n\n        return {\n            fileTarget: `${parts.filePath}${parts.search}`,\n            hash: parts.hash,\n        };\n    }\n\n    const relativeLinkExtension = {\n        walkTokens(token) {\n            if (!token || typeof token.href !== 'string') {\n                return;\n            }\n\n            if (token.type === 'image') {\n                const asset = transformRelativeAsset(token.href, 'image');\n                if (asset && asset.assetHref) {\n                    token.href = asset.assetHref;\n                }\n                return;\n            }\n\n            if (token.type !== 'link') {\n                return;\n            }\n\n            const result = transformRelativeAsset(token.href, 'link');\n            if (!result || !result.fileTarget) {\n                return;\n            }\n\n            const basePathname = typeof window !== 'undefined' && window.location ? window.location.pathname : '';\n            const query = buildQuery({ file: result.fileTarget });\n            token.href = `${basePathname}${query}${result.hash || ''}`;\n        },\n    };\n\n    function getCssNumber(variableName, fallback) {\n        if (typeof variableName !== 'string' || !variableName) {\n            return typeof fallback === 'number' ? fallback : 0;\n        }\n\n        try {\n            const computed = getComputedStyle(rootElement).getPropertyValue(variableName);\n            const parsed = Number.parseFloat(computed);\n            if (Number.isFinite(parsed)) {\n                return parsed;\n            }\n        } catch (error) {\n            console.warn('Failed to read CSS variable', variableName, error);\n        }\n\n        return typeof fallback === 'number' ? fallback : 0;\n    }\n\n    function configureMarked() {\n        if (typeof marked === 'undefined' || markedConfigured) {\n            return;\n        }\n\n        marked.use({\n            walkTokens(token) {\n                if (!token || token.type !== 'code') {\n                    return;\n                }\n\n                const language = typeof token.lang === 'string' ? token.lang.toLowerCase() : '';\n                const source = token.text || token.raw || '';\n\n                if (language.includes('mermaid')) {\n                    const id = `mermaid-diagram-${mermaidIdCounter++}`;\n                    const encodedSource = encodeMermaidSource(source);\n                    const mermaidHtml = `<div class=\"mermaid\" id=\"${id}\" data-mermaid-source=\"${encodedSource}\"></div>`;\n                    token.type = 'html';\n                    token.raw = mermaidHtml;\n                    token.text = mermaidHtml;\n                    return;\n                }\n\n                if (language.includes('vega-lite') || language === 'vega') {\n                    const id = `vega-diagram-${vegaIdCounter++}`;\n                    const encodedSource = encodeVegaSource(source);\n                    const vegaHtml = `<div class=\"vega-diagram\" id=\"${id}\" data-vega-source=\"${encodedSource}\"></div>`;\n                    token.type = 'html';\n                    token.raw = vegaHtml;\n                    token.text = vegaHtml;\n                    return;\n                }\n\n                if (language.includes('excalidraw')) {\n                    const id = `excalidraw-diagram-${excalidrawIdCounter++}`;\n                    const encodedSource = encodeExcalidrawSource(source);\n                    const excalidrawHtml = `<div class=\"excalidraw-diagram\" id=\"${id}\" data-excalidraw-source=\"${encodedSource}\"></div>`;\n                    token.type = 'html';\n                    token.raw = excalidrawHtml;\n                    token.text = excalidrawHtml;\n                }\n            },\n        });\n\n        marked.use({\n            headerIds: true,\n            mangle: false,\n            renderer: {\n                heading({ text, depth, raw }) {\n                    const headingLevel = Math.min(Math.max(depth || 1, 1), 6);\n\n                    // Create slug from the raw text or the rendered text\n                    const sourceText = typeof raw === 'string' ? raw : text;\n                    const slug = createSlug(sourceText);\n                    const plainText = normaliseHeadingText(text, raw);\n                    const ariaSource = plainText || (typeof raw === 'string' ? raw : 'heading');\n                    const ariaLabel = escapeHtml(`Link to section ${ariaSource}`);\n                    const headingLabel = plainText || ariaSource || 'this section';\n                    const safeSlug = escapeHtml(slug);\n                    const actionsAriaLabel = escapeHtml(`Section actions for ${headingLabel}`);\n                    const editLabel = escapeHtml(`Edit section \"${headingLabel}\" in the editor`);\n                    const copyLabel = escapeHtml(`Copy link to section \"${headingLabel}\"`);\n\n                    if (Array.isArray(activeHeadingCollection)) {\n                        activeHeadingCollection.push({\n                            level: headingLevel,\n                            text: plainText || ariaSource,\n                            slug,\n                        });\n                    }\n\n                    return `<h${headingLevel} id=\"${safeSlug}\">${text}<span class=\"heading-actions\" role=\"group\" aria-label=\"${actionsAriaLabel}\"><button type=\"button\" class=\"heading-action-button heading-action-edit\" data-heading-action=\"edit\" data-heading-slug=\"${safeSlug}\" title=\"${editLabel}\"><i class=\"fa-solid fa-pen-to-square\" aria-hidden=\"true\"></i><span class=\"sr-only\">${editLabel}</span></button><button type=\"button\" class=\"heading-action-button heading-action-copy\" data-heading-action=\"copy\" data-heading-slug=\"${safeSlug}\" title=\"${copyLabel}\"><i class=\"fa-solid fa-link\" aria-hidden=\"true\"></i><span class=\"sr-only\">${copyLabel}</span></button></span><a class=\"heading-anchor\" href=\"#${safeSlug}\" aria-label=\"${ariaLabel}\"></a></h${headingLevel}>`;\n                },\n            },\n        });\n\n        marked.setOptions({\n            breaks: true,\n            gfm: true,\n            highlight(code, language) {\n                if (typeof hljs === 'undefined') {\n                    return code;\n                }\n                try {\n                    if (language && hljs.getLanguage(language)) {\n                        return hljs.highlight(code, { language }).value;\n                    }\n                    return hljs.highlightAuto(code).value;\n                } catch (err) {\n                    console.warn('Highlight.js failed to render a block', err);\n                    return code;\n                }\n            },\n        });\n\n        if (!relativeLinkExtensionRegistered) {\n            marked.use(relativeLinkExtension);\n            relativeLinkExtensionRegistered = true;\n        }\n\n        markedConfigured = true;\n    }\n\n    function normaliseHeadingText(rendered, raw) {\n        if (typeof rendered === 'string' && rendered.trim()) {\n            const temp = document.createElement('div');\n            temp.innerHTML = rendered;\n            const textContent = (temp.textContent || temp.innerText || '').trim();\n            if (textContent) {\n                return textContent;\n            }\n        }\n\n        if (typeof raw === 'string') {\n            const trimmed = raw.trim();\n            if (trimmed) {\n                return trimmed;\n            }\n        }\n\n        return '';\n    }\n\n    function escapeHtml(value) {\n        return String(value)\n            .replace(/&/g, '&amp;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&#39;');\n    }\n\n    function computeBaseSlug(text) {\n        if (!text) {\n            return '';\n        }\n\n        const temp = document.createElement('div');\n        temp.innerHTML = text;\n        const cleanText = temp.textContent || temp.innerText || text;\n\n        return cleanText\n            .toLowerCase()\n            .trim()\n            .replace(/[^\\w\\s-]/g, '')\n            .replace(/\\s+/g, '-')\n            .replace(/-+/g, '-')\n            .replace(/^-+|-+$/g, '');\n    }\n\n    function createSlug(text) {\n        let slug = computeBaseSlug(text);\n\n        if (!slug) {\n            slug = 'heading';\n        }\n\n        if (documentSlugCounts) {\n            if (documentSlugCounts.has(slug)) {\n                const count = documentSlugCounts.get(slug) + 1;\n                documentSlugCounts.set(slug, count);\n                return `${slug}-${count}`;\n            }\n\n            documentSlugCounts.set(slug, 0);\n        }\n\n        return slug;\n    }\n\n    function captureHeadingLocations(markdownSource) {\n        headingLocationMap = new Map();\n\n        if (typeof markdownSource !== 'string' || !markdownSource) {\n            return;\n        }\n\n        const slugCounts = new Map();\n        const lines = markdownSource.split(/\\r?\\n/);\n\n        lines.forEach((line, index) => {\n            const match = line.match(/^(#{1,6})\\s+(.*)$/);\n            if (!match) {\n                return;\n            }\n\n            const rawHeading = match[2].trim();\n            let baseSlug = computeBaseSlug(rawHeading);\n            if (!baseSlug) {\n                baseSlug = 'heading';\n            }\n\n            let slug = baseSlug;\n            if (slugCounts.has(baseSlug)) {\n                const count = slugCounts.get(baseSlug) + 1;\n                slugCounts.set(baseSlug, count);\n                slug = `${baseSlug}-${count}`;\n            } else {\n                slugCounts.set(baseSlug, 0);\n            }\n\n            headingLocationMap.set(slug, {\n                line: index,\n                column: 0,\n                level: match[1].length,\n                text: rawHeading,\n            });\n        });\n    }\n\n    function clearEditorHeadingHighlight() {\n        if (!editorInstance || headingHighlightLine === null) {\n            headingHighlightLine = null;\n            return;\n        }\n\n        try {\n            editorInstance.removeLineClass(headingHighlightLine, 'background', 'heading-target-line');\n        } catch (error) {\n            console.warn('Failed to remove heading highlight', error);\n        }\n\n        headingHighlightLine = null;\n    }\n\n    function highlightEditorLine(lineNumber) {\n        const editor = ensureEditorInstance();\n        if (!editor || typeof editor.addLineClass !== 'function') {\n            return;\n        }\n\n        if (headingHighlightTimeout) {\n            window.clearTimeout(headingHighlightTimeout);\n            headingHighlightTimeout = null;\n        }\n\n        if (headingHighlightLine !== null) {\n            try {\n                editor.removeLineClass(headingHighlightLine, 'background', 'heading-target-line');\n            } catch (error) {\n                console.warn('Failed to clear previous heading highlight', error);\n            }\n        }\n\n        try {\n            editor.addLineClass(lineNumber, 'background', 'heading-target-line');\n            headingHighlightLine = lineNumber;\n        } catch (error) {\n            console.warn('Failed to apply heading highlight', error);\n            headingHighlightLine = null;\n            return;\n        }\n\n        headingHighlightTimeout = window.setTimeout(() => {\n            const instance = ensureEditorInstance();\n            if (instance && headingHighlightLine !== null) {\n                try {\n                    instance.removeLineClass(headingHighlightLine, 'background', 'heading-target-line');\n                } catch (error) {\n                    console.warn('Failed to remove heading highlight after delay', error);\n                }\n            }\n            headingHighlightLine = null;\n            headingHighlightTimeout = null;\n        }, 2000);\n    }\n\n    function handleHeadingActionClick(event) {\n        const button = event.target.closest('.heading-action-button');\n        if (!button) {\n            return;\n        }\n\n        if (!content || !content.contains(button)) {\n            return;\n        }\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        const action = button.dataset.headingAction;\n        const slug = button.dataset.headingSlug;\n\n        if (!slug) {\n            return;\n        }\n\n        if (action === 'edit') {\n            jumpToHeadingInEditor(slug);\n            return;\n        }\n\n        if (action === 'copy') {\n            copyHeadingLink(slug);\n        }\n    }\n\n    function jumpToHeadingInEditor(slug) {\n        if (!slug) {\n            return;\n        }\n\n        if (!currentFile) {\n            setStatus('Open a markdown file to edit sections.');\n            return;\n        }\n\n        const focusEditorOnHeading = () => {\n            const editor = ensureEditorInstance();\n            if (!editor) {\n                setStatus('Editor resources are still loading. Please try again in a moment.');\n                return;\n            }\n\n            let location = headingLocationMap.get(slug);\n            if (!location) {\n                const source = typeof editor.getValue === 'function' ? editor.getValue() : currentContent;\n                captureHeadingLocations(source);\n                location = headingLocationMap.get(slug);\n            }\n\n            if (!location) {\n                setStatus('Unable to locate this section in the editor.');\n                return;\n            }\n\n            const targetPosition = { line: location.line, ch: location.column || 0 };\n\n            editor.operation(() => {\n                editor.setCursor(targetPosition);\n                const bottomLine = Math.min(editor.lineCount() - 1, targetPosition.line + 5);\n                editor.scrollIntoView({ from: targetPosition, to: { line: bottomLine, ch: 0 } }, 200);\n                editor.focus();\n            });\n\n            highlightEditorLine(location.line);\n            setStatus('Jumped to section in editor.');\n        };\n\n        if (!isEditing) {\n            enterEditMode();\n            window.setTimeout(focusEditorOnHeading, 120);\n            return;\n        }\n\n        if (isPreviewing) {\n            returnToCodeMode();\n            window.setTimeout(focusEditorOnHeading, 120);\n            return;\n        }\n\n        focusEditorOnHeading();\n    }\n\n    function copyHeadingLink(slug) {\n        if (!slug) {\n            return;\n        }\n\n        const baseUrl = window.location.href.split('#')[0];\n        const link = `${baseUrl}#${slug}`;\n\n        const notifyFailure = (error) => {\n            if (error) {\n                console.warn('Failed to copy heading link', error);\n            }\n            setStatus(`Copy failed. Link: ${link}`);\n        };\n\n        const notifySuccess = () => {\n            setStatus('Copied link to clipboard.');\n        };\n\n        if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {\n            navigator.clipboard.writeText(link).then(notifySuccess).catch((error) => {\n                fallbackCopyLink(link, notifySuccess, () => notifyFailure(error));\n            });\n            return;\n        }\n\n        fallbackCopyLink(link, notifySuccess, notifyFailure);\n    }\n\n    function fallbackCopyLink(text, onSuccess, onFailure) {\n        const textarea = document.createElement('textarea');\n        textarea.value = text;\n        textarea.setAttribute('readonly', '');\n        textarea.style.position = 'absolute';\n        textarea.style.left = '-9999px';\n        document.body.appendChild(textarea);\n        textarea.select();\n\n        let succeeded = false;\n        let lastError = null;\n        try {\n            succeeded = document.execCommand('copy');\n        } catch (error) {\n            lastError = error;\n        }\n\n        document.body.removeChild(textarea);\n\n        if (succeeded) {\n            if (typeof onSuccess === 'function') {\n                onSuccess();\n            }\n            return;\n        }\n\n        if (typeof onFailure === 'function') {\n            onFailure(lastError);\n        }\n    }\n\n    function encodeDiagramSource(code) {\n        if (!code) {\n            return '';\n        }\n        const bytes = textEncoder.encode(code);\n        let binary = '';\n        bytes.forEach((byte) => {\n            binary += String.fromCharCode(byte);\n        });\n        return btoa(binary);\n    }\n\n    function decodeDiagramSource(encoded, label = 'diagram') {\n        if (!encoded) {\n            return '';\n        }\n        try {\n            const bytes = Uint8Array.from(atob(encoded), (char) => char.charCodeAt(0));\n            return textDecoder.decode(bytes);\n        } catch (error) {\n            console.warn(`Failed to decode ${label} source`, error);\n            return '';\n        }\n    }\n\n    function encodeMermaidSource(code) {\n        return encodeDiagramSource(code);\n    }\n\n    function decodeMermaidSource(encoded) {\n        return decodeDiagramSource(encoded, 'Mermaid');\n    }\n\n    function encodeVegaSource(code) {\n        return encodeDiagramSource(code);\n    }\n\n    function decodeVegaSource(encoded) {\n        return decodeDiagramSource(encoded, 'Vega');\n    }\n\n    function encodeExcalidrawSource(code) {\n        return encodeDiagramSource(code);\n    }\n\n    function decodeExcalidrawSource(encoded) {\n        return decodeDiagramSource(encoded, 'Excalidraw');\n    }\n\n    function createExcalidrawViewerUiOptions() {\n        return {\n            canvasActions: {\n                changeViewBackgroundColor: false,\n                clearCanvas: false,\n                export: false,\n                loadScene: false,\n                saveAsImage: false,\n                saveScene: false,\n                saveToActiveFile: false,\n                toggleTheme: false,\n                toggleShortcuts: false,\n                zoomIn: false,\n                zoomOut: false,\n                zoomToFit: false,\n                resetZoom: false,\n                pan: false,\n                viewMode: false,\n                zenMode: false,\n                gridMode: false,\n                stats: false,\n            },\n        };\n    }\n\n    function waitForCoreLibraries(maxRetries = 80, interval = 100) {\n        if (librariesReadyPromise) {\n            return librariesReadyPromise;\n        }\n\n        librariesReadyPromise = new Promise((resolve) => {\n            let attempts = 0;\n            const check = () => {\n                if (typeof marked !== 'undefined') {\n                    resolve();\n                    return;\n                }\n\n                if (attempts++ >= maxRetries) {\n                    resolve();\n                    return;\n                }\n\n                window.setTimeout(check, interval);\n            };\n\n            check();\n        });\n\n        return librariesReadyPromise;\n    }\n\n    const DIAGRAM_ICONS = {\n        Mermaid: '\uD83D\uDCCA',\n        Vega: '\uD83D\uDCC8',\n        Excalidraw: '\u270F\uFE0F',\n    };\n\n    function showDiagramStatus(element, type, message, source, variant) {\n        const icon = DIAGRAM_ICONS[type] || '\u2139\uFE0F';\n        const emphasised = variant === 'error' ? `<strong>${escapeHtml(message)}</strong>` : escapeHtml(message);\n        const sourceMarkup = source ? `<pre>${escapeHtml(source)}</pre>` : '';\n        element.innerHTML = `\n            <div class=\"diagram-loading\">\n                ${icon} <strong>${escapeHtml(type)}</strong><br>\n                ${emphasised}\n                ${sourceMarkup}\n            </div>\n        `;\n    }\n\n    function showDiagramLoading(element, type, source) {\n        showDiagramStatus(element, type, `${type} renderer loading\u2026`, source, 'loading');\n    }\n\n    function showDiagramError(element, type, message, source) {\n        showDiagramStatus(element, type, `Error: ${message}`, source, 'error');\n    }\n\n    function cleanupExcalidrawRoots() {\n        excalidrawRoots.forEach((record) => {\n            try {\n                if (record && typeof record.unmount === 'function') {\n                    record.unmount();\n                } else if (record && record.root && typeof record.root.unmount === 'function') {\n                    record.root.unmount();\n                }\n            } catch (error) {\n                console.warn('Failed to unmount Excalidraw root', error);\n            }\n        });\n        excalidrawRoots.clear();\n    }\n\n    function scheduleMermaidRetry() {\n        if (mermaidRetryTimer) {\n            return;\n        }\n        mermaidRetryTimer = window.setTimeout(() => {\n            mermaidRetryTimer = null;\n            renderMermaidDiagrams();\n        }, 400);\n    }\n\n    function scheduleVegaRetry() {\n        if (vegaRetryTimer) {\n            return;\n        }\n        vegaRetryTimer = window.setTimeout(() => {\n            vegaRetryTimer = null;\n            renderVegaVisualizations();\n        }, 400);\n    }\n\n    function scheduleExcalidrawRetry() {\n        if (excalidrawRetryTimer) {\n            return;\n        }\n        excalidrawRetryTimer = window.setTimeout(() => {\n            excalidrawRetryTimer = null;\n            renderExcalidrawDiagrams();\n        }, 400);\n    }\n\n    function handleExcalidrawResize() {\n        excalidrawRoots.forEach((record) => {\n            if (record && record.api) {\n                fitExcalidrawToViewport(record.api);\n            }\n        });\n    }\n\n    function ensureExcalidrawResizeHandler() {\n        if (excalidrawResizeHandlerAttached) {\n            return;\n        }\n        if (typeof window === 'undefined' || typeof window.addEventListener !== 'function') {\n            return;\n        }\n        window.addEventListener('resize', handleExcalidrawResize);\n        excalidrawResizeHandlerAttached = true;\n    }\n\n    function fitExcalidrawToViewport(api) {\n        if (!api || typeof api.getSceneElements !== 'function' || typeof api.scrollToContent !== 'function') {\n            return;\n        }\n\n        let elements;\n        try {\n            elements = api.getSceneElements();\n        } catch (error) {\n            console.warn('Failed to read Excalidraw scene elements', error);\n            return;\n        }\n\n        if (!Array.isArray(elements) || !elements.length) {\n            return;\n        }\n\n        const visibleElements = elements.filter((item) => item && !item.isDeleted);\n        if (!visibleElements.length) {\n            return;\n        }\n\n        const executeFit = () => {\n            try {\n                api.scrollToContent(visibleElements, { fitToViewport: true, animate: false });\n            } catch (error) {\n                if (!excalidrawFitFailureLogged) {\n                    console.warn('Failed to fit Excalidraw content', error);\n                    excalidrawFitFailureLogged = true;\n                }\n            }\n        };\n\n        if (typeof window !== 'undefined' && typeof window.requestAnimationFrame === 'function') {\n            window.requestAnimationFrame(executeFit);\n        } else {\n            executeFit();\n        }\n\n        if (typeof window !== 'undefined' && typeof window.setTimeout === 'function') {\n            window.setTimeout(executeFit, 150);\n        }\n    }\n\n    function renderMermaidDiagrams() {\n        const diagrams = content.querySelectorAll('.mermaid[data-mermaid-source]');\n        if (!diagrams.length) {\n            return;\n        }\n\n        if (typeof mermaid === 'undefined' || typeof mermaid.render !== 'function') {\n            diagrams.forEach((element) => {\n                const source = decodeMermaidSource(element.dataset.mermaidSource);\n                showDiagramLoading(element, 'Mermaid', source);\n            });\n            scheduleMermaidRetry();\n            return;\n        }\n\n        if (!mermaidInitAttempted) {\n            try {\n                mermaid.initialize({\n                    startOnLoad: false,\n                    theme: 'dark',\n                    securityLevel: 'loose',\n                });\n            } catch (error) {\n                console.warn('Mermaid initialization issue', error);\n            }\n            mermaidInitAttempted = true;\n        }\n\n        diagrams.forEach((element, index) => {\n            const source = decodeMermaidSource(element.dataset.mermaidSource);\n            if (!source.trim()) {\n                showDiagramError(element, 'Mermaid', 'Diagram source is empty', source);\n                return;\n            }\n\n            const renderId = `${element.id || 'mermaid-diagram'}-${index}`;\n            mermaid\n                .render(renderId, source)\n                .then(({ svg }) => {\n                    element.innerHTML = svg;\n                })\n                .catch((error) => {\n                    console.error('Mermaid rendering error', error);\n                    showDiagramError(element, 'Mermaid', error.message, source);\n                });\n        });\n    }\n\n    function renderVegaVisualizations() {\n        const diagrams = content.querySelectorAll('.vega-diagram[data-vega-source]');\n        if (!diagrams.length) {\n            return;\n        }\n\n        if (typeof vegaEmbed === 'undefined') {\n            diagrams.forEach((element) => {\n                const source = decodeVegaSource(element.dataset.vegaSource);\n                showDiagramLoading(element, 'Vega', source);\n            });\n            scheduleVegaRetry();\n            return;\n        }\n\n        diagrams.forEach((element) => {\n            const source = decodeVegaSource(element.dataset.vegaSource);\n            if (!source.trim()) {\n                showDiagramError(element, 'Vega', 'Specification is empty', source);\n                return;\n            }\n\n            let spec;\n            try {\n                spec = JSON.parse(source);\n            } catch (error) {\n                console.error('Vega parsing error', error);\n                showDiagramError(element, 'Vega', 'Invalid Vega/Vega-Lite specification', source);\n                return;\n            }\n\n            element.innerHTML = '';\n            vegaEmbed(element, spec, { actions: false, renderer: 'canvas', theme: 'dark' }).catch((error) => {\n                console.error('Vega rendering error', error);\n                showDiagramError(element, 'Vega', error.message, source);\n            });\n        });\n    }\n\n    function renderExcalidrawDiagrams() {\n        const diagrams = content.querySelectorAll('.excalidraw-diagram[data-excalidraw-source]');\n        if (!diagrams.length) {\n            return;\n        }\n\n        if (\n            !window.React ||\n            !window.ReactDOM ||\n            !window.ExcalidrawLib ||\n            !window.ExcalidrawLib.Excalidraw\n        ) {\n            diagrams.forEach((element) => {\n                const source = decodeExcalidrawSource(element.dataset.excalidrawSource);\n                showDiagramLoading(element, 'Excalidraw', source);\n            });\n            scheduleExcalidrawRetry();\n            return;\n        }\n\n        diagrams.forEach((element) => {\n            const source = decodeExcalidrawSource(element.dataset.excalidrawSource);\n            if (!source.trim()) {\n                showDiagramError(element, 'Excalidraw', 'Scene data is empty', source);\n                return;\n            }\n\n            let sceneData;\n            try {\n                sceneData = JSON.parse(source);\n            } catch (error) {\n                console.error('Excalidraw parsing error', error);\n                showDiagramError(element, 'Excalidraw', 'Invalid scene JSON', source);\n                return;\n            }\n\n            const desiredBackground = 'transparent';\n            sceneData = {\n                ...sceneData,\n                appState: {\n                    ...(sceneData && typeof sceneData === 'object' && sceneData.appState\n                        ? sceneData.appState\n                        : {}),\n                    viewBackgroundColor: desiredBackground,\n                },\n            };\n\n            const existingRoot = excalidrawRoots.get(element);\n            if (existingRoot && typeof existingRoot.unmount === 'function') {\n                try {\n                    existingRoot.unmount();\n                } catch (error) {\n                    console.warn('Failed to unmount previous Excalidraw root', error);\n                }\n            }\n            excalidrawRoots.delete(element);\n\n            element.innerHTML = '';\n            const wrapper = document.createElement('div');\n            wrapper.className = 'excalidraw-wrapper';\n            wrapper.tabIndex = -1;\n            element.appendChild(wrapper);\n\n            const record = {\n                root: null,\n                api: null,\n                wrapper,\n                unmount() {\n                    record.api = null;\n                    if (record.root && typeof record.root.unmount === 'function') {\n                        record.root.unmount();\n                    } else if (\n                        typeof window.ReactDOM !== 'undefined' &&\n                        typeof window.ReactDOM.unmountComponentAtNode === 'function'\n                    ) {\n                        try {\n                            window.ReactDOM.unmountComponentAtNode(wrapper);\n                        } catch (error) {\n                            console.warn('Failed to unmount Excalidraw instance', error);\n                        }\n                    }\n                },\n            };\n\n            try {\n                const viewerUiOptions = createExcalidrawViewerUiOptions();\n                const excalidrawElement = window.React.createElement(window.ExcalidrawLib.Excalidraw, {\n                    initialData: sceneData,\n                    viewModeEnabled: true,\n                    zenModeEnabled: false,\n                    gridModeEnabled: false,\n                    theme: 'dark',\n                    autoFocus: false,\n                    UIOptions: viewerUiOptions,\n                    handleKeyboardEvent: () => false,\n                    ref: (api) => {\n                        record.api = api || null;\n                        if (api) {\n                            excalidrawFitFailureLogged = false;\n                            ensureExcalidrawResizeHandler();\n                            fitExcalidrawToViewport(api);\n                            if (typeof window !== 'undefined' && typeof window.setTimeout === 'function') {\n                                window.setTimeout(() => fitExcalidrawToViewport(api), 250);\n                            }\n                        }\n                    },\n                });\n\n                let root;\n                if (typeof window.ReactDOM.createRoot === 'function') {\n                    root = window.ReactDOM.createRoot(wrapper);\n                    root.render(excalidrawElement);\n                } else if (typeof window.ReactDOM.render === 'function') {\n                    window.ReactDOM.render(excalidrawElement, wrapper);\n                    root = {\n                        unmount() {\n                            if (typeof window.ReactDOM.unmountComponentAtNode === 'function') {\n                                window.ReactDOM.unmountComponentAtNode(wrapper);\n                            }\n                        },\n                    };\n                } else {\n                    throw new Error('ReactDOM renderer is unavailable');\n                }\n\n                record.root = root;\n                excalidrawRoots.set(element, record);\n            } catch (error) {\n                record.api = null;\n                console.error('Excalidraw rendering error', error);\n                showDiagramError(element, 'Excalidraw', error.message, source);\n            }\n        });\n    }\n\n    function renderAllDiagrams() {\n        renderMermaidDiagrams();\n        renderVegaVisualizations();\n        renderExcalidrawDiagrams();\n    }\n\n    function setStatus(message) {\n        // Status banner removed; keep function to avoid touching callers.\n        void message;\n    }\n\n    function setConnectionStatus(connected) {\n        offlineOverlay.classList.toggle('visible', !connected);\n    }\n\n    function setHasPendingChanges(value) {\n        const nextValue = Boolean(value);\n        if (nextValue === hasPendingChanges) {\n            return;\n        }\n        hasPendingChanges = nextValue;\n        document.body.classList.toggle('document-has-pending-changes', hasPendingChanges);\n        updateHeader();\n    }\n\n    function updateDocumentPanelTitle() {\n        const viewerPanel = dockviewSetup?.panels?.viewer;\n        if (!viewerPanel) {\n            return;\n        }\n\n        const baseTitle = currentFile || 'Document';\n        const title = hasPendingChanges && currentFile ? `${baseTitle} \u25CF` : baseTitle;\n        const panelApi = viewerPanel?.api;\n\n        if (panelApi && typeof panelApi.setTitle === 'function') {\n            panelApi.setTitle(title);\n        } else if (typeof viewerPanel.setTitle === 'function') {\n            viewerPanel.setTitle(title);\n        }\n    }\n\n    function promptUnsavedChanges(context = {}) {\n        if (!unsavedChangesModal) {\n            return Promise.resolve('cancel');\n        }\n\n        if (activeUnsavedPrompt) {\n            return activeUnsavedPrompt;\n        }\n\n        const nextFile = typeof context.nextFile === 'string' ? context.nextFile : '';\n        const displayName = currentFile || 'this document';\n        if (unsavedChangesFilename) {\n            unsavedChangesFilename.textContent = displayName;\n        }\n        if (unsavedChangesMessage) {\n            unsavedChangesMessage.setAttribute('data-current-file', displayName);\n        }\n        if (unsavedChangesDetail) {\n            if (nextFile && nextFile !== currentFile) {\n                unsavedChangesDetail.textContent = `Switch to \u201C${nextFile}\u201D without saving?`;\n            } else {\n                unsavedChangesDetail.textContent = 'What would you like to do?';\n            }\n        }\n\n        unsavedChangesModal.classList.add('visible');\n        document.body.classList.add('modal-open');\n\n        const promise = new Promise((resolve) => {\n            const cleanup = () => {\n                unsavedChangesModal.classList.remove('visible');\n                document.body.classList.remove('modal-open');\n                if (unsavedChangesSaveButton) {\n                    unsavedChangesSaveButton.removeEventListener('click', onSave);\n                }\n                if (unsavedChangesDiscardButton) {\n                    unsavedChangesDiscardButton.removeEventListener('click', onDiscard);\n                }\n                if (unsavedChangesCancelButton) {\n                    unsavedChangesCancelButton.removeEventListener('click', onCancel);\n                }\n                unsavedChangesModal.removeEventListener('keydown', onKeyDown, true);\n                unsavedChangesModal.removeEventListener('click', onOverlayClick);\n                activeUnsavedPrompt = null;\n            };\n\n            const choose = (result) => {\n                cleanup();\n                resolve(result);\n            };\n\n            const onSave = () => choose('save');\n            const onDiscard = () => choose('discard');\n            const onCancel = () => choose('cancel');\n            const onKeyDown = (event) => {\n                if (event.key === 'Escape') {\n                    event.preventDefault();\n                    choose('cancel');\n                }\n            };\n            const onOverlayClick = (event) => {\n                if (event.target === unsavedChangesModal) {\n                    choose('cancel');\n                }\n            };\n\n            if (unsavedChangesSaveButton) {\n                unsavedChangesSaveButton.addEventListener('click', onSave);\n            }\n            if (unsavedChangesDiscardButton) {\n                unsavedChangesDiscardButton.addEventListener('click', onDiscard);\n            }\n            if (unsavedChangesCancelButton) {\n                unsavedChangesCancelButton.addEventListener('click', onCancel);\n            }\n\n            unsavedChangesModal.addEventListener('keydown', onKeyDown, true);\n            unsavedChangesModal.addEventListener('click', onOverlayClick);\n\n            window.setTimeout(() => {\n                if (typeof unsavedChangesSaveButton?.focus === 'function') {\n                    unsavedChangesSaveButton.focus();\n                } else if (typeof unsavedChangesDiscardButton?.focus === 'function') {\n                    unsavedChangesDiscardButton.focus();\n                } else {\n                    unsavedChangesModal.focus({ preventScroll: true });\n                }\n            }, 0);\n        });\n\n        activeUnsavedPrompt = promise;\n        return promise;\n    }\n\n    function updateHeader() {\n        const hasFile = Boolean(currentFile);\n        const indicator = hasPendingChanges && hasFile ? ' \u25CF' : '';\n\n        if (fileName) {\n            if (dockviewIsActive) {\n                if (hasFile) {\n                    fileName.textContent = `Markdown Viewer${indicator}`;\n                    fileName.classList.add('hidden');\n                } else {\n                    fileName.textContent = 'No file selected';\n                    fileName.classList.remove('hidden');\n                }\n            } else {\n                fileName.classList.remove('hidden');\n                const baseName = hasFile ? currentFile : 'No file selected';\n                fileName.textContent = hasFile ? `${baseName}${indicator}` : baseName;\n            }\n        }\n\n        sidebarPath.textContent = resolvedRootPath || originalPathArgument || 'Unknown';\n        downloadButton.disabled = !hasFile;\n        deleteButton.disabled = !hasFile;\n        editButton.disabled = !hasFile && !isEditing;\n        previewButton.disabled = !hasFile;\n        saveButton.disabled = !hasFile;\n        cancelButton.disabled = false;\n        updateActionVisibility();\n        updateDocumentPanelTitle();\n    }\n\n    function updateActionVisibility() {\n        const hasFile = Boolean(currentFile);\n        editButton.classList.toggle('hidden', !hasFile || (isEditing && !isPreviewing));\n        previewButton.classList.toggle('hidden', !isEditing || isPreviewing);\n        saveButton.classList.toggle('hidden', !isEditing);\n        cancelButton.classList.toggle('hidden', !isEditing);\n        downloadButton.classList.toggle('hidden', isEditing);\n        deleteButton.classList.toggle('hidden', isEditing);\n    }\n\n    function buildQuery(params) {\n        const query = new URLSearchParams();\n        if (originalPathArgument) {\n            query.set('path', originalPathArgument);\n        }\n        Object.entries(params).forEach(([key, value]) => {\n            if (value !== undefined && value !== null && value !== '') {\n                query.set(key, value);\n            }\n        });\n        const queryString = query.toString();\n        return queryString ? `?${queryString}` : '';\n    }\n\n    function updateLocation(file, { replace = false } = {}) {\n        const newQuery = buildQuery({ file });\n        const newUrl = `${window.location.pathname}${newQuery}`;\n        const currentUrl = `${window.location.pathname}${window.location.search}`;\n        const stateData = { file };\n\n        if (replace || newUrl === currentUrl) {\n            window.history.replaceState(stateData, '', newUrl);\n        } else {\n            window.history.pushState(stateData, '', newUrl);\n        }\n    }\n\n    function fileFromSearch(search) {\n        const params = new URLSearchParams(search || '');\n        const value = params.get('file');\n        if (typeof value !== 'string') {\n            return '';\n        }\n        const trimmed = value.trim();\n        return trimmed === '' ? '' : trimmed;\n    }\n\n    function renderMarkdown(markdownText, options = {}) {\n        cleanupExcalidrawRoots();\n        configureMarked();\n        updateRelativeLinkBase(currentFile);\n        mermaidIdCounter = 0;\n        vegaIdCounter = 0;\n        excalidrawIdCounter = 0;\n\n        // Reset slug counter for each document to ensure unique IDs\n        documentSlugCounts = new Map();\n\n        const sourceText = markdownText || '';\n        const updateCurrent = Boolean(options.updateCurrent);\n        captureHeadingLocations(sourceText);\n\n        if (typeof marked === 'undefined') {\n            activeHeadingCollection = null;\n            pendingMarkdown = sourceText;\n            content.textContent = sourceText;\n            updateTableOfContents([]);\n            waitForCoreLibraries().then(() => {\n                if (pendingMarkdown !== null) {\n                    const textToRender = pendingMarkdown;\n                    pendingMarkdown = null;\n                    renderMarkdown(textToRender, { updateCurrent });\n                }\n            });\n            if (updateCurrent) {\n                currentContent = sourceText;\n            }\n            return;\n        }\n\n        activeHeadingCollection = [];\n        content.innerHTML = marked.parse(sourceText);\n        const headings = Array.isArray(activeHeadingCollection) ? [...activeHeadingCollection] : [];\n        activeHeadingCollection = null;\n        pendingMarkdown = null;\n\n        if (typeof hljs !== 'undefined') {\n            content.querySelectorAll('pre code').forEach((block) => {\n                if (block.closest('.mermaid, .vega-diagram, .excalidraw-diagram')) {\n                    return;\n                }\n                try {\n                    hljs.highlightElement(block);\n                } catch (err) {\n                    console.warn('Highlight.js error', err);\n                }\n            });\n        }\n\n        updateTableOfContents(headings);\n        renderAllDiagrams();\n        if (updateCurrent) {\n            currentContent = sourceText;\n        }\n    }\n\n    function updateTableOfContents(headings) {\n        if (!tocList) {\n            return;\n        }\n\n        tocList.innerHTML = '';\n\n        if (!Array.isArray(headings) || headings.length === 0) {\n            const emptyState = document.createElement('p');\n            emptyState.className = 'toc-empty-state';\n            emptyState.textContent = 'No headings found in this document yet.';\n            tocList.appendChild(emptyState);\n            return;\n        }\n\n        const minLevel = headings.reduce((accumulator, entry) => {\n            const level = typeof entry.level === 'number' ? entry.level : 1;\n            return Math.min(accumulator, Math.max(1, Math.min(6, level)));\n        }, 6);\n\n        const list = document.createElement('ol');\n        list.setAttribute('role', 'list');\n\n        headings.forEach((entry) => {\n            const level = Math.max(1, Math.min(6, entry.level || 1));\n            const item = document.createElement('li');\n            item.className = 'toc-entry';\n\n            const link = document.createElement('a');\n            link.className = 'toc-link';\n            link.href = `#${entry.slug}`;\n            link.textContent = entry.text || entry.slug || 'Untitled section';\n            link.setAttribute('aria-level', String(level));\n            link.dataset.level = String(level);\n            const indentLevel = Math.max(0, level - minLevel);\n            link.style.paddingLeft = `${10 + indentLevel * 16}px`;\n\n            item.appendChild(link);\n            list.appendChild(item);\n        });\n\n        tocList.appendChild(list);\n    }\n\n    function handleTocClick(event) {\n        const link = event.target.closest('a.toc-link');\n        if (!link) {\n            return;\n        }\n\n        const hash = link.getAttribute('href');\n        if (typeof hash !== 'string' || !hash.startsWith('#')) {\n            return;\n        }\n\n        const targetId = hash.slice(1);\n        if (!targetId) {\n            return;\n        }\n\n        const targetElement = document.getElementById(targetId);\n        if (!targetElement) {\n            return;\n        }\n\n        event.preventDefault();\n\n        try {\n            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });\n        } catch (error) {\n            targetElement.scrollIntoView();\n        }\n\n        if (typeof history !== 'undefined' && typeof history.replaceState === 'function') {\n            const newUrl = `${window.location.pathname}${window.location.search}#${targetId}`;\n            history.replaceState(history.state, '', newUrl);\n        }\n    }\n\n    if (tocList) {\n        tocList.addEventListener('click', handleTocClick);\n    }\n\n    // ------------------------------------------------------------------\n    // Markdown editing helpers\n    // ------------------------------------------------------------------\n    function ensureEditorInstance() {\n        if (editorInstance) {\n            return editorInstance;\n        }\n        if (typeof window.CodeMirror === 'undefined') {\n            return null;\n        }\n\n        editorContainer.innerHTML = '';\n        suppressEditorChangeEvents = true;\n        try {\n            editorInstance = window.CodeMirror(editorContainer, {\n                value: draftContent,\n                mode: 'markdown',\n                theme: 'one-dark',\n                lineNumbers: true,\n                lineWrapping: true,\n                autofocus: true,\n            });\n            editorInstance.setSize('100%', '100%');\n            editorInstance.on('change', handleEditorContentChange);\n        } finally {\n            suppressEditorChangeEvents = false;\n        }\n        setHasPendingChanges(draftContent !== currentContent);\n        return editorInstance;\n    }\n\n    function handleEditorContentChange(instance) {\n        if (!instance || suppressEditorChangeEvents) {\n            return;\n        }\n        draftContent = instance.getValue();\n        setHasPendingChanges(draftContent !== currentContent);\n    }\n\n    function enterEditMode() {\n        if (!currentFile) {\n            return;\n        }\n        if (typeof window.CodeMirror === 'undefined') {\n            setStatus('Editor resources are still loading. Please try again in a moment.');\n            return;\n        }\n\n        isEditing = true;\n        isPreviewing = false;\n        draftContent = currentContent;\n        const editor = ensureEditorInstance();\n        if (!editor) {\n            isEditing = false;\n            setStatus('Editor resources are still loading. Please try again in a moment.');\n            updateActionVisibility();\n            return;\n        }\n\n        suppressEditorChangeEvents = true;\n        try {\n            editor.setValue(draftContent);\n        } finally {\n            suppressEditorChangeEvents = false;\n        }\n        setHasPendingChanges(false);\n        window.setTimeout(() => {\n            editor.refresh();\n            editor.focus();\n        }, 0);\n\n        content.classList.add('hidden');\n        editorContainer.classList.add('visible');\n        updateHeader();\n        setStatus('Editing markdown\u2026');\n    }\n\n    function enterPreviewMode() {\n        if (!isEditing) {\n            return;\n        }\n        const editor = ensureEditorInstance();\n        if (editor) {\n            draftContent = editor.getValue();\n        }\n        setHasPendingChanges(draftContent !== currentContent);\n        isPreviewing = true;\n        renderMarkdown(draftContent, { updateCurrent: false });\n        editorContainer.classList.remove('visible');\n        content.classList.remove('hidden');\n        updateHeader();\n        setStatus('Previewing changes.');\n    }\n\n    function returnToCodeMode() {\n        if (!isPreviewing) {\n            return;\n        }\n        isPreviewing = false;\n        renderMarkdown(currentContent, { updateCurrent: true });\n        content.classList.add('hidden');\n        editorContainer.classList.add('visible');\n        const editor = ensureEditorInstance();\n        if (editor) {\n            window.setTimeout(() => {\n                editor.refresh();\n                editor.focus();\n            }, 0);\n        }\n        updateHeader();\n        setStatus('Editing markdown\u2026');\n    }\n\n    function exitEditMode(options = {}) {\n        const { restoreContent = true } = options;\n        if (!isEditing && !isPreviewing) {\n            updateHeader();\n            return;\n        }\n        isEditing = false;\n        isPreviewing = false;\n        draftContent = '';\n        clearEditorHeadingHighlight();\n        content.classList.remove('hidden');\n        editorContainer.classList.remove('visible');\n        if (restoreContent) {\n            renderMarkdown(currentContent, { updateCurrent: true });\n        }\n        setHasPendingChanges(false);\n        updateHeader();\n    }\n\n\n    function resetViewToFallback(options = {}) {\n        const { skipHistory = false } = options;\n        exitEditMode({ restoreContent: false });\n        currentFile = null;\n        const fallback = fallbackMarkdownFor(resolvedRootPath || originalPathArgument || 'the selected path');\n        renderMarkdown(fallback, { updateCurrent: true });\n        updateActiveFileHighlight();\n        updateHeader();\n        if (!skipHistory) {\n            updateLocation('', { replace: true });\n        }\n    }\n    function renderFileList() {\n        fileList.innerHTML = '';\n\n        const treeToRender = Array.isArray(fileTree) && fileTree.length\n            ? fileTree\n            : buildTreeFromFlatList(files);\n\n        if (!treeToRender.length) {\n            const empty = document.createElement('li');\n            empty.className = 'empty-state';\n            empty.textContent = 'No markdown files yet';\n            fileList.appendChild(empty);\n            return;\n        }\n\n        ensureExpandedForCurrentFile(currentFile);\n\n        const visited = new Set();\n        const fragment = document.createDocumentFragment();\n        treeToRender.forEach((node) => {\n            fragment.appendChild(renderTreeNode(node, 0, visited));\n        });\n        fileList.appendChild(fragment);\n\n        const stale = [];\n        expandedDirectories.forEach((value) => {\n            if (!visited.has(value)) {\n                stale.push(value);\n            }\n        });\n        stale.forEach((value) => expandedDirectories.delete(value));\n\n        knownDirectories.clear();\n        visited.forEach((value) => knownDirectories.add(value));\n\n        updateActiveFileHighlight();\n    }\n\n    function renderTreeNode(node, depth, visited) {\n        const item = document.createElement('li');\n        item.className = `tree-node ${node.type === 'directory' ? 'directory-node' : 'file-node'}`;\n\n        if (node.type === 'directory') {\n            const pathKey = typeof node.relativePath === 'string' ? node.relativePath : '';\n            visited.add(pathKey);\n\n            if (!knownDirectories.has(pathKey) && !expandedDirectories.has(pathKey)) {\n                expandedDirectories.add(pathKey);\n            }\n\n            const row = document.createElement('div');\n            row.className = 'tree-row directory-row';\n            row.style.paddingLeft = `${depth * 16}px`;\n\n            const isExpanded = expandedDirectories.has(pathKey);\n            const toggle = document.createElement('button');\n            toggle.type = 'button';\n            toggle.className = 'tree-toggle';\n            toggle.setAttribute('aria-expanded', String(isExpanded));\n            toggle.setAttribute('aria-label', `${isExpanded ? 'Collapse' : 'Expand'} ${node.name}`);\n            toggle.textContent = isExpanded ? '\u25BE' : '\u25B8';\n            toggle.addEventListener('click', (event) => {\n                event.preventDefault();\n                event.stopPropagation();\n                toggleDirectory(pathKey);\n            });\n\n            const label = document.createElement('button');\n            label.type = 'button';\n            label.className = 'tree-label directory-label';\n\n            // Create folder icon element\n            const folderIcon = document.createElement('i');\n            folderIcon.className = isExpanded ? 'directory-icon fas fa-folder-open' : 'directory-icon fas fa-folder';\n\n            // Create text element\n            const labelText = document.createElement('span');\n            labelText.textContent = node.name;\n\n            // Append icon and text to label\n            label.appendChild(folderIcon);\n            label.appendChild(labelText);\n\n            label.addEventListener('click', (event) => {\n                event.preventDefault();\n                toggleDirectory(pathKey);\n            });\n\n            row.appendChild(toggle);\n            row.appendChild(label);\n            item.appendChild(row);\n\n            const childrenList = document.createElement('ul');\n            childrenList.className = 'tree-children';\n            if (!isExpanded) {\n                childrenList.classList.add('collapsed');\n            }\n            const children = Array.isArray(node.children) ? node.children : [];\n            children.forEach((child) => {\n                childrenList.appendChild(renderTreeNode(child, depth + 1, visited));\n            });\n            item.appendChild(childrenList);\n            return item;\n        }\n\n        const button = document.createElement('button');\n        button.className = 'file-button';\n        button.type = 'button';\n\n        // Create icon element\n        const icon = document.createElement('i');\n        icon.className = 'file-icon fab fa-markdown'; // Font Awesome markdown icon\n\n        // Create text element\n        const text = document.createElement('span');\n        text.textContent = node.name;\n\n        // Append icon and text to button\n        button.appendChild(icon);\n        button.appendChild(text);\n\n        button.dataset.file = node.relativePath;\n        button.style.paddingLeft = `${depth * 16 + 24}px`;\n        button.addEventListener('click', () => {\n            if (node.relativePath !== currentFile) {\n                selectFile(node.relativePath);\n            }\n        });\n        item.appendChild(button);\n        return item;\n    }\n\n    function ensureExpandedForCurrentFile(filePath) {\n        if (typeof filePath !== 'string' || !filePath.includes('/')) {\n            return;\n        }\n        const parts = filePath.split('/');\n        parts.pop();\n        let prefix = '';\n        parts.forEach((segment) => {\n            if (!segment) {\n                return;\n            }\n            prefix = prefix ? `${prefix}/${segment}` : segment;\n            expandedDirectories.add(prefix);\n        });\n    }\n\n    function toggleDirectory(pathKey) {\n        if (!pathKey && pathKey !== '') {\n            return;\n        }\n        if (expandedDirectories.has(pathKey)) {\n            expandedDirectories.delete(pathKey);\n        } else {\n            expandedDirectories.add(pathKey);\n        }\n        renderFileList();\n    }\n\n    function updateActiveFileHighlight() {\n        fileList.querySelectorAll('.file-button').forEach((button) => {\n            button.classList.toggle('active', button.dataset.file === currentFile);\n        });\n    }\n\n    async function fetchJson(url, options) {\n        const response = await fetch(url, options);\n        if (!response.ok) {\n            const text = await response.text();\n            throw new Error(text || `Request failed with status ${response.status}`);\n        }\n        return response.json();\n    }\n\n    async function refreshFiles() {\n        const url = `/api/files${buildQuery({})}`;\n        const data = await fetchJson(url);\n        resolvedRootPath = data.rootPath || resolvedRootPath;\n        const updatedIndex = normaliseFileIndex({ filesValue: data.files, treeValue: data.tree });\n        files = updatedIndex.files;\n        fileTree = updatedIndex.tree;\n        renderFileList();\n        if (!files.find((entry) => entry.relativePath === currentFile)) {\n            currentFile = files.length ? files[0].relativePath : null;\n            if (currentFile) {\n                await loadFile(currentFile, { replaceHistory: true });\n            } else {\n                currentFile = null;\n                exitEditMode({ restoreContent: false });\n                renderMarkdown(\n                    fallbackMarkdownFor(resolvedRootPath || originalPathArgument || 'the selected path'),\n                    { updateCurrent: true }\n                );\n                updateLocation('', { replace: true });\n                updateHeader();\n            }\n        } else {\n            updateActiveFileHighlight();\n            updateHeader();\n        }\n    }\n\n    function fallbackMarkdownFor(path) {\n        return `# No markdown files found\\n\\nThe directory \\`${path}\\` does not contain any markdown files yet.`;\n    }\n\n    async function loadFile(file, options = {}) {\n        const { skipHistory = false, replaceHistory = false } = options;\n        if (isEditing || isPreviewing) {\n            setStatus('Editing session closed because the file was reloaded.');\n            exitEditMode();\n        } else {\n            setStatus('');\n        }\n        const url = `/api/file${buildQuery({ file })}`;\n        try {\n            const data = await fetchJson(url);\n            resolvedRootPath = data.rootPath || resolvedRootPath;\n            currentFile = data.file || file;\n            renderMarkdown(data.content || '', { updateCurrent: true });\n            setHasPendingChanges(false);\n            updateActiveFileHighlight();\n            updateHeader();\n            updateLocation(currentFile, { replace: replaceHistory || skipHistory });\n        } catch (err) {\n            setStatus(err.message);\n            console.error('Failed to load file', err);\n        }\n    }\n\n    async function saveCurrentFile() {\n        if (!isEditing || !currentFile) {\n            return false;\n        }\n\n        const editor = ensureEditorInstance();\n        if (editor && !isPreviewing) {\n            draftContent = editor.getValue();\n        }\n\n        const contentToSave = draftContent;\n        setStatus('Saving changes\u2026');\n\n        try {\n            await fetchJson(`/api/file${buildQuery({ file: currentFile })}`, {\n                method: 'PUT',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ content: contentToSave }),\n            });\n            currentContent = contentToSave;\n            exitEditMode();\n            setStatus('Changes saved.');\n            updateActiveFileHighlight();\n            return true;\n        } catch (err) {\n            setStatus(err.message);\n            console.error('Save failed', err);\n            return false;\n        }\n    }\n\n    async function selectFile(file) {\n        if (hasPendingChanges) {\n            const decision = await promptUnsavedChanges({ nextFile: file });\n            if (decision === 'cancel') {\n                return;\n            }\n            if (decision === 'save') {\n                const saved = await saveCurrentFile();\n                if (!saved) {\n                    return;\n                }\n            } else if (decision === 'discard') {\n                exitEditMode();\n                setStatus('Changes discarded.');\n            }\n        } else if (isEditing || isPreviewing) {\n            exitEditMode();\n        }\n        await loadFile(file);\n    }\n\n    function setupActions() {\n        editButton.addEventListener('click', () => {\n            if (isEditing && isPreviewing) {\n                returnToCodeMode();\n                return;\n            }\n            if (!isEditing) {\n                enterEditMode();\n            }\n        });\n\n        previewButton.addEventListener('click', () => {\n            if (!currentFile) {\n                return;\n            }\n            enterPreviewMode();\n        });\n\n        cancelButton.addEventListener('click', () => {\n            if (!isEditing && !isPreviewing) {\n                return;\n            }\n            exitEditMode();\n            setStatus('Edits cancelled.');\n        });\n\n        saveButton.addEventListener('click', async () => {\n            await saveCurrentFile();\n        });\n\n        downloadButton.addEventListener('click', async () => {\n            if (!currentFile) {\n                return;\n            }\n            try {\n                const data = await fetchJson(`/api/file${buildQuery({ file: currentFile })}`);\n                const blob = new Blob([data.content || ''], { type: 'text/markdown' });\n                const url = URL.createObjectURL(blob);\n                const link = document.createElement('a');\n                link.href = url;\n                link.download = currentFile;\n                document.body.appendChild(link);\n                link.click();\n                document.body.removeChild(link);\n                URL.revokeObjectURL(url);\n            } catch (err) {\n                setStatus(err.message);\n                console.error('Download failed', err);\n            }\n        });\n\n        deleteButton.addEventListener('click', async () => {\n            if (!currentFile) {\n                return;\n            }\n            const confirmed = window.confirm(`Delete ${currentFile}?`);\n            if (!confirmed) {\n                return;\n            }\n            try {\n                await fetchJson(`/api/file${buildQuery({ file: currentFile })}`, { method: 'DELETE' });\n                setStatus('File deleted.');\n                await refreshFiles();\n            } catch (err) {\n                setStatus(err.message);\n                console.error('Delete failed', err);\n            }\n        });\n    }\n\n    function connectWebSocket() {\n        if (websocket) {\n            websocket.close();\n        }\n\n        const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';\n        websocket = new WebSocket(`${protocol}://${window.location.host}/ws`);\n\n        websocket.addEventListener('open', () => {\n            setConnectionStatus(true);\n            websocket.send(JSON.stringify({ type: 'subscribe', path: originalPathArgument }));\n        });\n\n        websocket.addEventListener('message', async (event) => {\n            try {\n                const payload = JSON.parse(event.data);\n                if (payload.type === 'directory_update') {\n                    resolvedRootPath = payload.path || resolvedRootPath;\n                    const updatedIndex = normaliseFileIndex({\n                        filesValue: payload.files,\n                        treeValue: payload.tree,\n                    });\n                    files = updatedIndex.files;\n                    fileTree = updatedIndex.tree;\n                    renderFileList();\n                    if (!files.find((entry) => entry.relativePath === currentFile)) {\n                        currentFile = files.length ? files[0].relativePath : null;\n                        if (currentFile) {\n                            await loadFile(currentFile, { replaceHistory: true });\n                        } else {\n                            currentFile = null;\n                            exitEditMode({ restoreContent: false });\n                            renderMarkdown(\n                                fallbackMarkdownFor(resolvedRootPath || originalPathArgument || 'the selected path'),\n                                { updateCurrent: true }\n                            );\n                            updateLocation('', { replace: true });\n                            updateHeader();\n                        }\n                    } else {\n                        updateActiveFileHighlight();\n                        updateHeader();\n                    }\n                } else if (payload.type === 'file_changed') {\n                    if (payload.file && payload.file === currentFile) {\n                        await loadFile(currentFile, { replaceHistory: true });\n                    }\n                }\n            } catch (err) {\n                console.error('Failed to process websocket event', err);\n            }\n        });\n\n        function scheduleReconnect() {\n            if (reconnectTimer) {\n                return;\n            }\n            reconnectTimer = window.setTimeout(() => {\n                reconnectTimer = null;\n                connectWebSocket();\n            }, 1500);\n        }\n\n        websocket.addEventListener('close', () => {\n            setConnectionStatus(false);\n            scheduleReconnect();\n        });\n\n        websocket.addEventListener('error', () => {\n            websocket.close();\n        });\n    }\n\n    function scheduleTerminalLibraryRetry() {\n        if (terminalLibraryRetryTimer) {\n            return;\n        }\n        terminalLibraryRetryTimer = window.setTimeout(() => {\n            terminalLibraryRetryTimer = null;\n            if (!terminalInstance) {\n                ensureTerminalInstance();\n            }\n            if (!terminalSocket) {\n                connectTerminal();\n            }\n        }, 250);\n    }\n\n    function areTerminalLibrariesReady() {\n        return (\n            typeof window !== 'undefined' &&\n            typeof window.Terminal === 'function' &&\n            window.FitAddon &&\n            typeof window.FitAddon.FitAddon === 'function'\n        );\n    }\n\n    function ensureTerminalInstance() {\n        if (terminalInstance || !terminalContainer) {\n            return terminalInstance;\n        }\n\n        if (!areTerminalLibrariesReady()) {\n            scheduleTerminalLibraryRetry();\n            return null;\n        }\n\n        try {\n            terminalInstance = new window.Terminal({\n                convertEol: true,\n                cursorBlink: true,\n                fontFamily: 'Menlo, Monaco, \"Courier New\", monospace',\n                fontSize: 13,\n                theme: {\n                    // Palette derived from the provided macOS Terminal profile to keep the\n                    // in-browser terminal consistent with the requested look-and-feel.\n                    background: '#21252b',\n                    foreground: '#abb2bf',\n                    cursor: '#abb2bf',\n                    cursorAccent: '#21252b',\n                    selection: '#323844',\n                    selectionForeground: '#abb2bf',\n                    black: '#21252b',\n                    red: '#e06c75',\n                    green: '#98c379',\n                    yellow: '#e5c07b',\n                    blue: '#61afef',\n                    magenta: '#c678dd',\n                    cyan: '#56b6c2',\n                    white: '#abb2bf',\n                    brightBlack: '#767676',\n                    brightRed: '#e06c75',\n                    brightGreen: '#98c379',\n                    brightYellow: '#e5c07b',\n                    brightBlue: '#61afef',\n                    brightMagenta: '#c678dd',\n                    brightCyan: '#56b6c2',\n                    brightWhite: '#abb2bf',\n                },\n            });\n        } catch (error) {\n            console.warn('Failed to initialise terminal instance', error);\n            terminalInstance = null;\n            return null;\n        }\n\n        try {\n            terminalFitAddon = new window.FitAddon.FitAddon();\n            terminalInstance.loadAddon(terminalFitAddon);\n        } catch (error) {\n            console.warn('Failed to load terminal fit addon', error);\n            terminalInstance.dispose();\n            terminalInstance = null;\n            return null;\n        }\n\n        terminalInstance.open(terminalContainer);\n        terminalInstance.focus();\n\n        terminalInstance.onData((data) => {\n            if (terminalSocket && terminalSocket.readyState === WebSocket.OPEN) {\n                terminalSocket.send(JSON.stringify({ type: 'input', data }));\n            }\n        });\n\n        terminalInstance.onResize((size) => {\n            if (terminalSocket && terminalSocket.readyState === WebSocket.OPEN) {\n                terminalSocket.send(\n                    JSON.stringify({ type: 'resize', cols: size.cols, rows: size.rows })\n                );\n            }\n        });\n\n        scheduleTerminalFit();\n        return terminalInstance;\n    }\n\n    function scheduleTerminalFit() {\n        if (!terminalInstance || !terminalFitAddon || terminalCollapsed) {\n            return;\n        }\n\n        if (pendingTerminalFitFrame) {\n            window.cancelAnimationFrame(pendingTerminalFitFrame);\n        }\n\n        pendingTerminalFitFrame = window.requestAnimationFrame(() => {\n            pendingTerminalFitFrame = null;\n            fitTerminal();\n        });\n    }\n\n    function fitTerminal() {\n        if (!terminalInstance || !terminalFitAddon || terminalCollapsed) {\n            return;\n        }\n\n        try {\n            terminalFitAddon.fit();\n        } catch (error) {\n            console.warn('Unable to fit terminal to container', error);\n            return;\n        }\n\n        sendTerminalResize();\n    }\n\n    function sendTerminalResize() {\n        if (!terminalInstance || !terminalSocket || terminalSocket.readyState !== WebSocket.OPEN) {\n            return;\n        }\n        terminalSocket.send(\n            JSON.stringify({ type: 'resize', cols: terminalInstance.cols, rows: terminalInstance.rows })\n        );\n    }\n\n    function updateTerminalStatus(message) {\n        if (terminalStatusText) {\n            terminalStatusText.textContent = message || '';\n        }\n        terminalLastStatusMessage = message || '';\n    }\n\n    function scheduleTerminalReconnect(delay = 1500) {\n        if (terminalReconnectTimer) {\n            return;\n        }\n        terminalReconnectTimer = window.setTimeout(() => {\n            terminalReconnectTimer = null;\n            connectTerminal();\n        }, delay);\n    }\n\n    function connectTerminal() {\n        if (!terminalContainer) {\n            return;\n        }\n\n        if (terminalSocket &&\n            (terminalSocket.readyState === WebSocket.OPEN || terminalSocket.readyState === WebSocket.CONNECTING)) {\n            return;\n        }\n\n        const terminal = ensureTerminalInstance();\n        if (!terminal) {\n            scheduleTerminalLibraryRetry();\n            return;\n        }\n\n        const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';\n        const socket = new WebSocket(`${protocol}://${window.location.host}/ws/terminal`);\n        socket.binaryType = 'arraybuffer';\n        terminalSocket = socket;\n        updateTerminalStatus('Connecting\u2026');\n\n        socket.addEventListener('open', () => {\n            if (terminalReconnectTimer) {\n                window.clearTimeout(terminalReconnectTimer);\n                terminalReconnectTimer = null;\n            }\n            updateTerminalStatus('Connected');\n            scheduleTerminalFit();\n        });\n\n        socket.addEventListener('message', (event) => {\n            if (!terminalInstance) {\n                return;\n            }\n\n            if (typeof event.data === 'string') {\n                try {\n                    const payload = JSON.parse(event.data);\n                    if (payload.type === 'state' && typeof payload.message === 'string') {\n                        updateTerminalStatus(payload.message);\n                        return;\n                    }\n                    if (payload.type === 'exit') {\n                        if (typeof payload.code === 'number') {\n                            updateTerminalStatus(`Process exited (${payload.code})`);\n                        } else {\n                            updateTerminalStatus('Process exited');\n                        }\n                        scheduleTerminalReconnect();\n                        return;\n                    }\n                } catch (error) {\n                    // Treat as raw output when parsing fails.\n                    terminalInstance.write(event.data);\n                    return;\n                }\n\n                terminalInstance.write(event.data);\n                return;\n            }\n\n            const consumeBuffer = (buffer) => {\n                if (!buffer) {\n                    return;\n                }\n                const text = terminalDecoder.decode(buffer);\n                if (text) {\n                    terminalInstance.write(text);\n                }\n            };\n\n            if (event.data instanceof ArrayBuffer) {\n                consumeBuffer(new Uint8Array(event.data));\n                return;\n            }\n\n            if (event.data && typeof event.data.arrayBuffer === 'function') {\n                event.data\n                    .arrayBuffer()\n                    .then((buffer) => consumeBuffer(new Uint8Array(buffer)))\n                    .catch((error) => console.warn('Failed to decode terminal payload', error));\n            }\n        });\n\n        socket.addEventListener('close', () => {\n            terminalSocket = null;\n            if (!terminalLastStatusMessage.startsWith('Process exited')) {\n                updateTerminalStatus('Disconnected \u2013 reconnecting\u2026');\n            }\n            scheduleTerminalReconnect();\n        });\n\n        socket.addEventListener('error', () => {\n            updateTerminalStatus('Connection error');\n            socket.close();\n        });\n    }\n\n    function setupTerminalPanel() {\n        if (!terminalPanel) {\n            return;\n        }\n\n        if (!dockviewIsActive && terminalResizeObserver) {\n            terminalResizeObserver.disconnect();\n            terminalResizeObserver = null;\n        }\n\n        if (dockviewIsActive) {\n            terminalCollapsed = false;\n            terminalPanel.style.height = '';\n            terminalPanel.style.maxHeight = '';\n            terminalPanel.classList.remove('is-collapsed');\n            if (terminalResizeHandle) {\n                terminalResizeHandle.remove();\n            }\n            if (terminalToggleButton) {\n                terminalToggleButton.disabled = true;\n                terminalToggleButton.textContent = 'Terminal (layout-managed)';\n                terminalToggleButton.setAttribute('aria-expanded', 'true');\n            }\n\n            if (!terminalResizeObserver && typeof window.ResizeObserver === 'function') {\n                const resizeTarget = terminalPanel.parentElement || terminalPanel;\n                if (resizeTarget) {\n                    terminalResizeObserver = new window.ResizeObserver(() => {\n                        scheduleTerminalFit();\n                    });\n                    terminalResizeObserver.observe(resizeTarget);\n                }\n            }\n\n            const instance = ensureTerminalInstance();\n            if (instance) {\n                scheduleTerminalFit();\n            }\n            connectTerminal();\n            return;\n        }\n\n        const minHeight = 140;\n\n        const clampHeight = (value) => {\n            const max = Math.max(minHeight, Math.round(window.innerHeight * 0.75));\n            if (Number.isFinite(value)) {\n                return Math.min(Math.max(value, minHeight), max);\n            }\n            return minHeight;\n        };\n\n        const persistHeight = () => {\n            if (typeof window.localStorage === 'undefined') {\n                return;\n            }\n            try {\n                window.localStorage.setItem(terminalStorageKey, String(terminalHeight));\n            } catch (error) {\n                // Ignore persistence errors (e.g. storage disabled).\n            }\n        };\n\n        const applyHeight = (value, { persist = false } = {}) => {\n            const clamped = clampHeight(value);\n            terminalHeight = clamped;\n            terminalPanel.style.height = `${clamped}px`;\n            if (persist) {\n                persistHeight();\n            }\n            scheduleTerminalFit();\n            return clamped;\n        };\n\n        const restoreHeightFromStorage = () => {\n            if (typeof window.localStorage === 'undefined') {\n                terminalHeight = clampHeight(terminalPanel.getBoundingClientRect().height || 260);\n                return;\n            }\n            let stored = null;\n            try {\n                stored = window.localStorage.getItem(terminalStorageKey);\n            } catch (error) {\n                stored = null;\n            }\n            const numeric = stored === null ? NaN : Number(stored);\n            if (Number.isFinite(numeric)) {\n                applyHeight(numeric);\n            } else {\n                terminalHeight = clampHeight(terminalPanel.getBoundingClientRect().height || 260);\n            }\n        };\n\n        const setCollapsed = (value) => {\n            const collapsed = Boolean(value);\n            if (terminalCollapsed === collapsed) {\n                return;\n            }\n            terminalCollapsed = collapsed;\n            terminalPanel.classList.toggle('is-collapsed', collapsed);\n            if (terminalToggleButton) {\n                terminalToggleButton.setAttribute('aria-expanded', String(!collapsed));\n                terminalToggleButton.textContent = collapsed ? 'Show terminal' : 'Hide terminal';\n            }\n\n            if (collapsed) {\n                terminalPanel.style.height = '';\n                return;\n            }\n\n            applyHeight(terminalHeight || clampHeight(terminalPanel.getBoundingClientRect().height || 260));\n\n            if (terminalPanel) {\n                const handleTransitionEnd = (event) => {\n                    if (event.target !== terminalPanel || event.propertyName !== 'height') {\n                        return;\n                    }\n                    terminalPanel.removeEventListener('transitionend', handleTransitionEnd);\n                    scheduleTerminalFit();\n                };\n                terminalPanel.addEventListener('transitionend', handleTransitionEnd, { once: true });\n            }\n\n            const instance = ensureTerminalInstance();\n            if (instance) {\n                instance.focus();\n                if (typeof instance.scrollToBottom === 'function') {\n                    instance.scrollToBottom();\n                }\n            }\n\n            connectTerminal();\n        };\n\n        restoreHeightFromStorage();\n\n        if (terminalToggleButton) {\n            terminalToggleButton.addEventListener('click', () => {\n                setCollapsed(!terminalCollapsed);\n            });\n        }\n\n        if (terminalResizeHandle) {\n            terminalResizeHandle.addEventListener('pointerdown', (event) => {\n                if (event.button !== 0) {\n                    return;\n                }\n                if (terminalCollapsed) {\n                    setCollapsed(false);\n                }\n                event.preventDefault();\n                const startY = event.clientY;\n                const startHeight = terminalPanel.getBoundingClientRect().height;\n\n                const handleMove = (moveEvent) => {\n                    const delta = startY - moveEvent.clientY;\n                    const next = clampHeight(startHeight + delta);\n                    applyHeight(next);\n                };\n\n                const handleUp = () => {\n                    document.removeEventListener('pointermove', handleMove);\n                    document.removeEventListener('pointerup', handleUp);\n                    persistHeight();\n                    scheduleTerminalFit();\n                };\n\n                document.addEventListener('pointermove', handleMove);\n                document.addEventListener('pointerup', handleUp);\n            });\n\n            terminalResizeHandle.addEventListener('keydown', (event) => {\n                if (event.key !== 'ArrowUp' && event.key !== 'ArrowDown') {\n                    return;\n                }\n                event.preventDefault();\n                if (terminalCollapsed) {\n                    setCollapsed(false);\n                }\n                const offset = event.key === 'ArrowUp' ? 32 : -32;\n                const next = clampHeight((terminalHeight || terminalPanel.getBoundingClientRect().height) + offset);\n                applyHeight(next, { persist: true });\n            });\n\n            terminalResizeHandle.addEventListener('dblclick', () => {\n                if (terminalCollapsed) {\n                    setCollapsed(false);\n                }\n                applyHeight(clampHeight(260), { persist: true });\n            });\n        }\n\n        window.addEventListener('resize', () => {\n            if (terminalCollapsed) {\n                return;\n            }\n            const current = terminalHeight || terminalPanel.getBoundingClientRect().height;\n            const clamped = clampHeight(current);\n            if (clamped !== current) {\n                applyHeight(clamped, { persist: true });\n            } else {\n                scheduleTerminalFit();\n            }\n        });\n\n        setCollapsed(false);\n        ensureTerminalInstance();\n        connectTerminal();\n    }\n\n    window.addEventListener('beforeunload', () => {\n        if (terminalSocket && terminalSocket.readyState === WebSocket.OPEN) {\n            try {\n                terminalSocket.close();\n            } catch (error) {\n                // Swallow shutdown errors.\n            }\n        }\n    });\n\n    function initialise() {\n        const initialFallback = fallbackMarkdownFor(resolvedRootPath || originalPathArgument || 'the selected path');\n        renderMarkdown(state.content || initialFallback, { updateCurrent: true });\n        renderFileList();\n        updateHeader();\n        if (state.error) {\n            setStatus(state.error);\n        }\n        setupActions();\n        setupTerminalPanel();\n        connectWebSocket();\n        if (!currentFile && files.length) {\n            currentFile = files[0].relativePath;\n        }\n\n        if (!initialFileFromLocation && currentFile) {\n            loadFile(currentFile, { replaceHistory: true });\n        }\n    }\n\n    window.addEventListener('popstate', () => {\n        const targetFile = fileFromSearch(window.location.search);\n        if (targetFile) {\n            if (targetFile !== currentFile) {\n                loadFile(targetFile, { skipHistory: true, replaceHistory: true });\n            }\n        } else {\n            resetViewToFallback({ skipHistory: true });\n        }\n    });\n\n    initialise();\n\n    if (initialFileFromLocation) {\n        loadFile(initialFileFromLocation, { replaceHistory: true });\n    }\n}\n\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', bootstrap, { once: true });\n} else {\n    bootstrap();\n}\n"],
  "mappings": "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",
  "names": ["bootstrap", "state", "content", "fileName", "sidebarPath", "fileList", "downloadButton", "deleteButton", "editButton", "previewButton", "saveButton", "cancelButton", "editorContainer", "offlineOverlay", "unsavedChangesModal", "unsavedChangesFilename", "unsavedChangesMessage", "unsavedChangesDetail", "unsavedChangesSaveButton", "unsavedChangesDiscardButton", "unsavedChangesCancelButton", "tocList", "tocSidebar", "fileSidebar", "tocSplitter", "fileSplitter", "dockviewRoot", "appShell", "rootElement", "viewerSection", "terminalPanel", "terminalContainer", "terminalToggleButton", "terminalStatusText", "terminalResizeHandle", "terminalStorageKey", "panelToggleButtons", "panelToggleButtonMap", "dockviewLayoutStorageKey", "dockviewLayoutSaveDelayMs", "dockviewLayoutSaveTimer", "dockviewPointerActive", "button", "panelName", "event", "nextVisible", "getPanelVisibility", "setPanelVisibility", "handleHeadingActionClick", "initialIndex", "normaliseFileIndex", "currentFile", "files", "fileTree", "websocket", "reconnectTimer", "isEditing", "isPreviewing", "editorInstance", "draftContent", "currentContent", "hasPendingChanges", "suppressEditorChangeEvents", "activeUnsavedPrompt", "originalPathArgument", "resolvedRootPath", "initialFileFromLocation", "fileFromSearch", "textEncoder", "textDecoder", "markedConfigured", "mermaidInitAttempted", "mermaidRetryTimer", "vegaRetryTimer", "excalidrawRetryTimer", "mermaidIdCounter", "vegaIdCounter", "excalidrawIdCounter", "excalidrawRoots", "excalidrawResizeHandlerAttached", "excalidrawFitFailureLogged", "librariesReadyPromise", "pendingMarkdown", "relativeLinksEnabled", "relativeLinkBasePath", "relativeLinkBaseWalker", "relativeLinkExtensionRegistered", "headingLocationMap", "headingHighlightLine", "headingHighlightTimeout", "relativeLinkDummyOrigin", "relativeLinkSchemePattern", "relativeLinkProtocolRelativePattern", "expandedDirectories", "knownDirectories", "dockviewSetup", "initialiseDockviewLayout", "dockviewIsActive", "refreshPanelToggleStates", "handleDockviewPointerDown", "handleDockviewPointerFinish", "activeHeadingCollection", "documentSlugCounts", "terminalInstance", "terminalFitAddon", "terminalSocket", "terminalReconnectTimer", "terminalLibraryRetryTimer", "terminalCollapsed", "terminalHeight", "pendingTerminalFitFrame", "terminalResizeObserver", "terminalDecoder", "terminalLastStatusMessage", "updatePanelToggleButtonState", "name", "isVisible", "_a", "_b", "_c", "panel", "groupApi", "toggleLegacySidebar", "visible", "targetSidebar", "widthVar", "defaultWidth", "splitter", "scheduleDockviewLayoutSave", "_button", "restoreDockviewLayout", "instance", "rawLayout", "storageError", "savedLayout", "error", "clearError", "persistDockviewLayout", "layoutState", "serialisedLayout", "panelSources", "dockview", "element", "source", "placeholder", "currentViewerTitle", "viewerPanel", "tocPanel", "filesPanel", "terminalDockviewPanel", "setup", "api", "filesValue", "treeValue", "flat", "tree", "flattenTree", "buildTreeFromFlatList", "nodes", "result", "stack", "node", "flatList", "root", "directoryMap", "ensureDirectory", "path", "parentPath", "parentChildren", "file", "segments", "currentPath", "segment", "sortTree", "a", "b", "updateRelativeLinkBase", "filePath", "lastSlashIndex", "baseCandidate", "decodePathSegments", "e", "encodePathSegments", "fallbackResolveRelativeHref", "href", "baseReference", "baseUrl", "resolvedUrl", "normalisedPath", "splitResolvedHref", "resolvedHref", "working", "hash", "hashIndex", "search", "searchIndex", "cleaned", "transformRelativeAsset", "rawHref", "tokenType", "trimmedHref", "walker", "tempToken", "parts", "relativeLinkExtension", "token", "asset", "basePathname", "query", "buildQuery", "getCssNumber", "variableName", "fallback", "computed", "parsed", "configureMarked", "language", "id", "encodedSource", "encodeMermaidSource", "mermaidHtml", "encodeVegaSource", "vegaHtml", "encodeExcalidrawSource", "excalidrawHtml", "text", "depth", "raw", "headingLevel", "slug", "createSlug", "plainText", "normaliseHeadingText", "ariaSource", "ariaLabel", "escapeHtml", "headingLabel", "safeSlug", "actionsAriaLabel", "editLabel", "copyLabel", "code", "err", "rendered", "temp", "textContent", "trimmed", "value", "computeBaseSlug", "count", "captureHeadingLocations", "markdownSource", "slugCounts", "line", "index", "match", "rawHeading", "baseSlug", "clearEditorHeadingHighlight", "highlightEditorLine", "lineNumber", "editor", "ensureEditorInstance", "action", "jumpToHeadingInEditor", "copyHeadingLink", "focusEditorOnHeading", "location", "targetPosition", "bottomLine", "enterEditMode", "returnToCodeMode", "link", "notifyFailure", "notifySuccess", "fallbackCopyLink", "onSuccess", "onFailure", "textarea", "succeeded", "lastError", "encodeDiagramSource", "bytes", "binary", "byte", "decodeDiagramSource", "encoded", "label", "char", "decodeMermaidSource", "decodeVegaSource", "decodeExcalidrawSource", "createExcalidrawViewerUiOptions", "waitForCoreLibraries", "maxRetries", "interval", "resolve", "attempts", "check", "DIAGRAM_ICONS", "showDiagramStatus", "type", "message", "variant", "icon", "emphasised", "sourceMarkup", "showDiagramLoading", "showDiagramError", "cleanupExcalidrawRoots", "record", "scheduleMermaidRetry", "renderMermaidDiagrams", "scheduleVegaRetry", "renderVegaVisualizations", "scheduleExcalidrawRetry", "renderExcalidrawDiagrams", "handleExcalidrawResize", "fitExcalidrawToViewport", "ensureExcalidrawResizeHandler", "elements", "visibleElements", "item", "executeFit", "diagrams", "renderId", "svg", "spec", "sceneData", "existingRoot", "wrapper", "viewerUiOptions", "excalidrawElement", "renderAllDiagrams", "setStatus", "setConnectionStatus", "connected", "setHasPendingChanges", "nextValue", "updateHeader", "updateDocumentPanelTitle", "baseTitle", "title", "panelApi", "promptUnsavedChanges", "context", "nextFile", "displayName", "promise", "cleanup", "onSave", "onDiscard", "onCancel", "onKeyDown", "onOverlayClick", "choose", "hasFile", "indicator", "baseName", "updateActionVisibility", "params", "key", "queryString", "updateLocation", "replace", "newQuery", "newUrl", "currentUrl", "stateData", "renderMarkdown", "markdownText", "options", "sourceText", "updateCurrent", "updateTableOfContents", "textToRender", "headings", "block", "emptyState", "minLevel", "accumulator", "entry", "level", "list", "indentLevel", "handleTocClick", "targetId", "targetElement", "handleEditorContentChange", "enterPreviewMode", "exitEditMode", "restoreContent", "resetViewToFallback", "skipHistory", "fallbackMarkdownFor", "updateActiveFileHighlight", "renderFileList", "treeToRender", "empty", "ensureExpandedForCurrentFile", "visited", "fragment", "renderTreeNode", "stale", "pathKey", "row", "isExpanded", "toggle", "toggleDirectory", "folderIcon", "labelText", "childrenList", "child", "selectFile", "prefix", "fetchJson", "url", "response", "refreshFiles", "data", "updatedIndex", "loadFile", "replaceHistory", "saveCurrentFile", "contentToSave", "decision", "setupActions", "blob", "connectWebSocket", "protocol", "payload", "scheduleReconnect", "scheduleTerminalLibraryRetry", "ensureTerminalInstance", "connectTerminal", "areTerminalLibrariesReady", "size", "scheduleTerminalFit", "fitTerminal", "sendTerminalResize", "updateTerminalStatus", "scheduleTerminalReconnect", "delay", "socket", "consumeBuffer", "buffer", "setupTerminalPanel", "resizeTarget", "minHeight", "clampHeight", "max", "persistHeight", "applyHeight", "persist", "clamped", "restoreHeightFromStorage", "stored", "numeric", "setCollapsed", "collapsed", "handleTransitionEnd", "startY", "startHeight", "handleMove", "moveEvent", "delta", "next", "handleUp", "offset", "current", "initialise", "initialFallback", "targetFile"]
}
