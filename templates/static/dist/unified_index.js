(()=>{function Kt(){let T=window.__INITIAL_STATE__||{},v=document.getElementById("content"),J=document.getElementById("file-name"),Xt=document.getElementById("sidebar-path"),xe=document.getElementById("file-list"),Ne=document.getElementById("download-button"),He=document.getElementById("delete-button"),Oe=document.getElementById("edit-button"),Ve=document.getElementById("preview-button"),Ue=document.getElementById("save-button"),ze=document.getElementById("cancel-button"),X=document.getElementById("editor-container"),en=document.getElementById("offline-overlay"),M=document.getElementById("unsaved-changes-modal"),lt=document.getElementById("unsaved-changes-filename"),ct=document.getElementById("unsaved-changes-message"),_e=document.getElementById("unsaved-changes-detail"),O=document.getElementById("unsaved-changes-save"),V=document.getElementById("unsaved-changes-discard"),Se=document.getElementById("unsaved-changes-cancel"),ee=document.getElementById("toc-list"),P=document.querySelector(".sidebar--toc"),F=document.querySelector(".sidebar--files"),fe=document.getElementById("toc-splitter"),me=document.getElementById("file-splitter"),B=document.getElementById("dockview-root"),te=document.querySelector(".app-shell"),dt=document.documentElement,ut=document.querySelector(".viewer"),g=document.getElementById("terminal-panel"),qe=document.getElementById("terminal-container"),I=document.getElementById("terminal-toggle"),ft=document.getElementById("terminal-status"),ne=document.getElementById("terminal-resize-handle"),mt="terminalPanelHeight",tn=Array.from(document.querySelectorAll("[data-panel-toggle]")),je=new Map,Je="dockviewLayout",nn=750,Te=null,$e=!1;tn.forEach(e=>{let t=e.dataset.panelToggle;t&&(je.set(t,e),e.addEventListener("click",n=>{n.preventDefault();let r=!nt(t);un(t,r)}))}),v&&v.addEventListener("click",Tn);let pt=it({filesValue:T.files,treeValue:T.fileTree}),c=T.selectedFile||null,k=pt.files,pe=pt.tree,D=null,We=null,h=!1,b=!1,U=null,L="",$=typeof T.content=="string"?T.content:"",ie=!1,ge=!1,Ae=null,z=T.pathArgument||"",C=T.rootPath||"",Ye=zt(window.location.search),rn=new TextEncoder,on=new TextDecoder,gt=!1,ht=!1,Ge=null,Qe=null,Ze=null,wt=0,yt=0,vt=0,re=new Map,bt=!1,Ke=!1,Me=null,he=null,Xe=!1,we="",ye=null,Et=!1,Pe=new Map,x=null,ve=null,an="http://__dummy__/",sn=/^[a-zA-Z][\w+.-]*:/,ln=/^\/\//,R=new Set,et=new Set,m=hn(),be=!!m;document.body.classList.toggle("dockview-active",be),fn(),be&&B&&(B.addEventListener("pointerdown",gn),window.addEventListener("pointerup",Ct),window.addEventListener("pointercancel",Ct));let W=null,oe=null,p=null,Ee=null,y=null,ae=null,tt=null,A=!1,Y=null,Fe=null,se=null,cn=new TextDecoder,Lt="";function le(e,t){let n=je.get(e);n&&n.setAttribute("aria-pressed",String(!!t))}function nt(e){var t,n,i;if(m&&m.panels&&m.panels[e]){let r=m.panels[e],o=(t=r==null?void 0:r.group)==null?void 0:t.api;return o&&typeof o.isVisible=="boolean"?o.isVisible:(i=(n=r==null?void 0:r.api)==null?void 0:n.isVisible)!=null?i:!0}return e==="toc"&&P?!P.classList.contains("hidden"):e==="files"&&F?!F.classList.contains("hidden"):!0}function dn(e,t){let n=e==="toc"?P:e==="files"?F:null;if(!n)return;n.classList.toggle("hidden",!t),n.classList.toggle("is-expanded",t);let i=e==="toc"?"--toc-sidebar-current-width":"--file-sidebar-current-width",r=e==="toc"?"var(--toc-sidebar-width)":"var(--file-sidebar-width)";dt.style.setProperty(i,t?r:"var(--sidebar-collapsed-width)");let o=e==="toc"?fe:me;o&&o.classList.toggle("hidden",!t)}function un(e,t){var n;if(m&&m.panels&&m.panels[e]){let i=m.panels[e],r=(n=i==null?void 0:i.group)==null?void 0:n.api;r&&typeof r.setVisible=="function"?r.setVisible(t):i!=null&&i.api&&typeof i.api.setVisible=="function"&&i.api.setVisible(t)}else dn(e,t);e==="toc"&&P?P.classList.toggle("is-expanded",t):e==="files"&&F&&F.classList.toggle("is-expanded",t),le(e,t),window.requestAnimationFrame(()=>{le(e,nt(e))}),kt()}function fn(){je.forEach((e,t)=>{le(t,nt(t))})}function mn(e){if(!e||typeof window.localStorage=="undefined")return!1;let t=null;try{t=window.localStorage.getItem(Je)}catch(n){return console.warn("Dockview layout restore skipped: storage unavailable.",n),!1}if(!t)return!1;try{let n=JSON.parse(t);if(typeof e.restoreLayout=="function")e.restoreLayout(n);else if(typeof e.fromJSON=="function")e.fromJSON(n);else throw new Error("Dockview instance cannot restore layouts");return!0}catch(n){console.warn("Failed to restore dockview layout; clearing saved state.",n);try{window.localStorage.removeItem(Je)}catch(i){console.warn("Unable to clear saved dockview layout.",i)}}return!1}function pn(){if(!(!(m!=null&&m.instance)||typeof window.localStorage=="undefined"))try{let{instance:e}=m,t=typeof e.saveLayout=="function"?e.saveLayout():typeof e.toJSON=="function"?e.toJSON():(()=>{throw new Error("Dockview instance cannot serialise layouts")})(),n=JSON.stringify(t);window.localStorage.setItem(Je,n)}catch(e){console.warn("Failed to persist dockview layout.",e)}}function kt(){m!=null&&m.instance&&(Te&&window.clearTimeout(Te),Te=window.setTimeout(()=>{Te=null,pn()},nn))}function gn(e){if(!(m!=null&&m.instance)||!B){$e=!1;return}$e=B.contains(e.target)}function Ct(){$e&&($e=!1,kt())}function hn(){var l,u;if(window.__dockviewSetup=null,!B)return null;if(!window.dockview||!window.dockview.DockviewComponent)return B.classList.add("hidden"),te&&te.classList.remove("hidden"),window.__dockviewSetup=null,null;if(!ut||!P||!F||!g)return console.warn("Dockview initialisation skipped: missing panel sources."),B.classList.add("hidden"),te&&te.classList.remove("hidden"),window.__dockviewSetup=null,null;fe&&fe.parentElement&&fe.parentElement.removeChild(fe),me&&me.parentElement&&me.parentElement.removeChild(me);let e={viewer:ut,toc:P,files:F,terminal:g};P&&P.classList.add("is-expanded"),F&&F.classList.add("is-expanded");let t=new window.dockview.DockviewComponent(B,{hideBorders:!0,createComponent({name:d}){let f=document.createElement("div");f.classList.add("dockview-panel-container",`dockview-panel-${d}`);let w=e[d];if(w)f.appendChild(w);else{let S=document.createElement("div");S.className="panel-missing",S.textContent=`Missing panel: ${d}`,f.appendChild(S)}return{element:f,init(){},dispose(){}}}}),n=typeof c=="string"&&c.length?c:"Document",i=t.addPanel({id:"dockview-viewer",component:"viewer",title:n}),r=t.addPanel({id:"dockview-toc",component:"toc",title:"Table of contents",position:{referencePanel:i,direction:"left"}}),o=t.addPanel({id:"dockview-files",component:"files",title:"Files",position:{referencePanel:i,direction:"right"}}),a=t.addPanel({id:"dockview-terminal",component:"terminal",title:"Terminal",position:{referencePanel:i,direction:"bottom"}});B.classList.remove("hidden"),te&&te.classList.add("hidden");let s={instance:t,panels:{viewer:i,toc:r,files:o,terminal:a}};return window.__dockviewSetup=s,mn(t),[["toc",(l=r==null?void 0:r.group)==null?void 0:l.api],["files",(u=o==null?void 0:o.group)==null?void 0:u.api]].forEach(([d,f])=>{f&&typeof f.onDidVisibilityChange=="function"&&f.onDidVisibilityChange(({isVisible:w})=>{le(d,w)})}),le("toc",!0),le("files",!0),s}function it({filesValue:e,treeValue:t}){let n=[],i=[];return Array.isArray(e)?n=e:e&&Array.isArray(e.files)&&(n=e.files,Array.isArray(e.tree)&&(i=e.tree)),!i.length&&Array.isArray(t)&&(i=t),i.length&&!n.length&&(n=wn(i)),!i.length&&n.length&&(i=xt(n)),{files:n,tree:i}}function wn(e){let t=[];if(!Array.isArray(e))return t;let n=[...e];for(;n.length;){let i=n.shift();if(!(!i||typeof i!="object")){if(i.type==="file"){t.push({name:i.name,relativePath:i.relativePath,size:i.size,updated:i.updated});continue}i.type==="directory"&&Array.isArray(i.children)&&n.unshift(...i.children)}}return t}function xt(e){if(!Array.isArray(e)||!e.length)return[];let t=[],n=new Map;n.set("",t);function i(r,o){if(n.has(r))return n.get(r);let a=r.includes("/")?r.slice(0,r.lastIndexOf("/")):"",s=n.get(a)||t,l={type:"directory",name:o,relativePath:r,children:[]};return s.push(l),n.set(r,l.children),l.children}return e.forEach(r=>{if(!r||typeof r.relativePath!="string")return;let o=r.relativePath.split("/"),a=o.pop(),s="";o.forEach(d=>{d&&(s=s?`${s}/${d}`:d,i(s,d))});let l=o.join("/");(n.get(l)||t).push({type:"file",name:a,relativePath:r.relativePath,size:r.size,updated:r.updated})}),St(t),t}function St(e){Array.isArray(e)&&(e.sort((t,n)=>t.type===n.type?String(t.name||"").localeCompare(String(n.name||"")):t.type==="directory"?-1:1),e.forEach(t=>{t.type==="directory"&&St(t.children)}))}function yn(e){if(typeof e!="string"||e.length===0){Xe=!1,we="",ye=null;return}Xe=!0;let t=e.lastIndexOf("/");if(we=t===-1?"":e.slice(0,t+1),typeof markedBaseUrl!="undefined"&&markedBaseUrl&&typeof markedBaseUrl.baseUrl=="function"){let n=we||"./";try{ye=markedBaseUrl.baseUrl(n)}catch(i){console.warn("Failed to initialise marked-base-url",i),ye=null}}else ye=null}function Tt(e){return e?e.split("/").map(t=>{try{return decodeURIComponent(t)}catch(n){return t}}).join("/"):""}function vn(e){return e?e.split("/").map(t=>encodeURIComponent(t)).join("/"):""}function $t(e){try{let t=we||".",n=new URL(t,an),i=new URL(e,n),r=i.pathname.replace(/^\/+/u,"");return`${Tt(r)}${i.search}${i.hash}`}catch(t){return console.warn("Relative link fallback failed",t),e}}function bn(e){if(typeof e!="string"||e.length===0)return{filePath:"",search:"",hash:""};let t=e,n="",i=t.indexOf("#");i!==-1&&(n=t.slice(i),t=t.slice(0,i));let r="",o=t.indexOf("?");o!==-1&&(r=t.slice(o),t=t.slice(0,o));let a=t.replace(/^\.\//,"").replace(/^\/+/u,"");return{filePath:Tt(a),search:r,hash:n}}function At(e,t){if(!Xe||typeof e!="string")return null;let n=e.trim();if(!n||n.startsWith("#")||ln.test(n)||sn.test(n)||n.startsWith("/"))return null;let i=n,r=ye;if(r&&typeof r.walkTokens=="function"){let a={type:t,href:n};try{r.walkTokens(a),i=a.href}catch(s){console.warn("marked-base-url resolution failed",s),i=$t(n)}}else i=$t(n);let o=bn(i);return o.filePath?t==="image"?{assetHref:`${vn(o.filePath)}${o.search}${o.hash}`}:{fileTarget:`${o.filePath}${o.search}`,hash:o.hash}:null}let En={walkTokens(e){if(!e||typeof e.href!="string")return;if(e.type==="image"){let r=At(e.href,"image");r&&r.assetHref&&(e.href=r.assetHref);return}if(e.type!=="link")return;let t=At(e.href,"link");if(!t||!t.fileTarget)return;let n=typeof window!="undefined"&&window.location?window.location.pathname:"",i=G({file:t.fileTarget});e.href=`${n}${i}${t.hash||""}`}};function ri(e,t){if(typeof e!="string"||!e)return typeof t=="number"?t:0;try{let n=getComputedStyle(dt).getPropertyValue(e),i=Number.parseFloat(n);if(Number.isFinite(i))return i}catch(n){console.warn("Failed to read CSS variable",e,n)}return typeof t=="number"?t:0}function Ln(){typeof marked=="undefined"||gt||(marked.use({walkTokens(e){if(!e||e.type!=="code")return;let t=typeof e.lang=="string"?e.lang.toLowerCase():"",n=e.text||e.raw||"";if(t.includes("mermaid")){let i=`mermaid-diagram-${wt++}`,r=Mn(n),o=`<div class="mermaid" id="${i}" data-mermaid-source="${r}"></div>`;e.type="html",e.raw=o,e.text=o;return}if(t.includes("vega-lite")||t==="vega"){let i=`vega-diagram-${yt++}`,r=Pn(n),o=`<div class="vega-diagram" id="${i}" data-vega-source="${r}"></div>`;e.type="html",e.raw=o,e.text=o;return}if(t.includes("excalidraw")){let i=`excalidraw-diagram-${vt++}`,r=Fn(n),o=`<div class="excalidraw-diagram" id="${i}" data-excalidraw-source="${r}"></div>`;e.type="html",e.raw=o,e.text=o}}}),marked.use({headerIds:!0,mangle:!1,renderer:{heading({text:e,depth:t,raw:n}){let i=Math.min(Math.max(t||1,1),6),o=Cn(typeof n=="string"?n:e),a=kn(e,n),s=a||(typeof n=="string"?n:"heading"),l=N(`Link to section ${s}`),u=a||s||"this section",d=N(o),f=N(`Section actions for ${u}`),w=N(`Edit section "${u}" in the editor`),S=N(`Copy link to section "${u}"`);return Array.isArray(W)&&W.push({level:i,text:a||s,slug:o}),`<h${i} id="${d}">${e}<span class="heading-actions" role="group" aria-label="${f}"><button type="button" class="heading-action-button heading-action-edit" data-heading-action="edit" data-heading-slug="${d}" title="${w}"><i class="fa-solid fa-pen-to-square" aria-hidden="true"></i><span class="sr-only">${w}</span></button><button type="button" class="heading-action-button heading-action-copy" data-heading-action="copy" data-heading-slug="${d}" title="${S}"><i class="fa-solid fa-link" aria-hidden="true"></i><span class="sr-only">${S}</span></button></span><a class="heading-anchor" href="#${d}" aria-label="${l}"></a></h${i}>`}}}),marked.setOptions({breaks:!0,gfm:!0,highlight(e,t){if(typeof hljs=="undefined")return e;try{return t&&hljs.getLanguage(t)?hljs.highlight(e,{language:t}).value:hljs.highlightAuto(e).value}catch(n){return console.warn("Highlight.js failed to render a block",n),e}}}),Et||(marked.use(En),Et=!0),gt=!0)}function kn(e,t){if(typeof e=="string"&&e.trim()){let n=document.createElement("div");n.innerHTML=e;let i=(n.textContent||n.innerText||"").trim();if(i)return i}if(typeof t=="string"){let n=t.trim();if(n)return n}return""}function N(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Mt(e){if(!e)return"";let t=document.createElement("div");return t.innerHTML=e,(t.textContent||t.innerText||e).toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+|-+$/g,"")}function Cn(e){let t=Mt(e);if(t||(t="heading"),oe){if(oe.has(t)){let n=oe.get(t)+1;return oe.set(t,n),`${t}-${n}`}oe.set(t,0)}return t}function Pt(e){if(Pe=new Map,typeof e!="string"||!e)return;let t=new Map;e.split(/\r?\n/).forEach((i,r)=>{let o=i.match(/^(#{1,6})\s+(.*)$/);if(!o)return;let a=o[2].trim(),s=Mt(a);s||(s="heading");let l=s;if(t.has(s)){let u=t.get(s)+1;t.set(s,u),l=`${s}-${u}`}else t.set(s,0);Pe.set(l,{line:r,column:0,level:o[1].length,text:a})})}function xn(){if(!U||x===null){x=null;return}try{U.removeLineClass(x,"background","heading-target-line")}catch(e){console.warn("Failed to remove heading highlight",e)}x=null}function Sn(e){let t=Q();if(!(!t||typeof t.addLineClass!="function")){if(ve&&(window.clearTimeout(ve),ve=null),x!==null)try{t.removeLineClass(x,"background","heading-target-line")}catch(n){console.warn("Failed to clear previous heading highlight",n)}try{t.addLineClass(e,"background","heading-target-line"),x=e}catch(n){console.warn("Failed to apply heading highlight",n),x=null;return}ve=window.setTimeout(()=>{let n=Q();if(n&&x!==null)try{n.removeLineClass(x,"background","heading-target-line")}catch(i){console.warn("Failed to remove heading highlight after delay",i)}x=null,ve=null},2e3)}}function Tn(e){let t=e.target.closest(".heading-action-button");if(!t||!v||!v.contains(t))return;e.preventDefault(),e.stopPropagation();let n=t.dataset.headingAction,i=t.dataset.headingSlug;if(i){if(n==="edit"){$n(i);return}n==="copy"&&An(i)}}function $n(e){if(!e)return;if(!c){return}let t=()=>{let n=Q();if(!n){return}let i=Pe.get(e);if(!i){let o=typeof n.getValue=="function"?n.getValue():$;Pt(o),i=Pe.get(e)}if(!i){return}let r={line:i.line,ch:i.column||0};n.operation(()=>{n.setCursor(r);let o=Math.min(n.lineCount()-1,r.line+5);n.scrollIntoView({from:r,to:{line:o,ch:0}},200),n.focus()}),Sn(i.line)};if(!h){qt(),window.setTimeout(t,120);return}if(b){jt(),window.setTimeout(t,120);return}t()}function An(e){if(!e)return;let n=`${window.location.href.split("#")[0]}#${e}`,i=o=>{o&&console.warn("Failed to copy heading link",o),`${n}`},r=()=>{};if(navigator.clipboard&&typeof navigator.clipboard.writeText=="function"){navigator.clipboard.writeText(n).then(r).catch(o=>{Ft(n,r,()=>i(o))});return}Ft(n,r,i)}function Ft(e,t,n){let i=document.createElement("textarea");i.value=e,i.setAttribute("readonly",""),i.style.position="absolute",i.style.left="-9999px",document.body.appendChild(i),i.select();let r=!1,o=null;try{r=document.execCommand("copy")}catch(a){o=a}if(document.body.removeChild(i),r){typeof t=="function"&&t();return}typeof n=="function"&&n(o)}function rt(e){if(!e)return"";let t=rn.encode(e),n="";return t.forEach(i=>{n+=String.fromCharCode(i)}),btoa(n)}function ot(e,t="diagram"){if(!e)return"";try{let n=Uint8Array.from(atob(e),i=>i.charCodeAt(0));return on.decode(n)}catch(n){return console.warn(`Failed to decode ${t} source`,n),""}}function Mn(e){return rt(e)}function Bt(e){return ot(e,"Mermaid")}function Pn(e){return rt(e)}function It(e){return ot(e,"Vega")}function Fn(e){return rt(e)}function Dt(e){return ot(e,"Excalidraw")}function Bn(){return{canvasActions:{changeViewBackgroundColor:!1,clearCanvas:!1,export:!1,loadScene:!1,saveAsImage:!1,saveScene:!1,saveToActiveFile:!1,toggleTheme:!1,toggleShortcuts:!1,zoomIn:!1,zoomOut:!1,zoomToFit:!1,resetZoom:!1,pan:!1,viewMode:!1,zenMode:!1,gridMode:!1,stats:!1}}}function In(e=80,t=100){return Me||(Me=new Promise(n=>{let i=0,r=()=>{if(typeof marked!="undefined"){n();return}if(i++>=e){n();return}window.setTimeout(r,t)};r()}),Me)}let Dn={Mermaid:"\u{1F4CA}",Vega:"\u{1F4C8}",Excalidraw:"\u270F\uFE0F"};function Rt(e,t,n,i,r){let o=Dn[t]||"\u2139\uFE0F",a=r==="error"?`<strong>${N(n)}</strong>`:N(n),s=i?`<pre>${N(i)}</pre>`:"";e.innerHTML=`
            <div class="diagram-loading">
                ${o} <strong>${N(t)}</strong><br>
                ${a}
                ${s}
            </div>
        `}function at(e,t,n){Rt(e,t,`${t} renderer loading\u2026`,n,"loading")}function _(e,t,n,i){Rt(e,t,`Error: ${n}`,i,"error")}function Rn(){re.forEach(e=>{try{e&&typeof e.unmount=="function"?e.unmount():e&&e.root&&typeof e.root.unmount=="function"&&e.root.unmount()}catch(t){console.warn("Failed to unmount Excalidraw root",t)}}),re.clear()}function Nn(){Ge||(Ge=window.setTimeout(()=>{Ge=null,Nt()},400))}function Hn(){Qe||(Qe=window.setTimeout(()=>{Qe=null,Ht()},400))}function On(){Ze||(Ze=window.setTimeout(()=>{Ze=null,Ot()},400))}function Vn(){re.forEach(e=>{e&&e.api&&st(e.api)})}function Un(){bt||typeof window=="undefined"||typeof window.addEventListener!="function"||(window.addEventListener("resize",Vn),bt=!0)}function st(e){if(!e||typeof e.getSceneElements!="function"||typeof e.scrollToContent!="function")return;let t;try{t=e.getSceneElements()}catch(r){console.warn("Failed to read Excalidraw scene elements",r);return}if(!Array.isArray(t)||!t.length)return;let n=t.filter(r=>r&&!r.isDeleted);if(!n.length)return;let i=()=>{try{e.scrollToContent(n,{fitToViewport:!0,animate:!1})}catch(r){Ke||(console.warn("Failed to fit Excalidraw content",r),Ke=!0)}};typeof window!="undefined"&&typeof window.requestAnimationFrame=="function"?window.requestAnimationFrame(i):i(),typeof window!="undefined"&&typeof window.setTimeout=="function"&&window.setTimeout(i,150)}function Nt(){let e=v.querySelectorAll(".mermaid[data-mermaid-source]");if(e.length){if(typeof mermaid=="undefined"||typeof mermaid.render!="function"){e.forEach(t=>{let n=Bt(t.dataset.mermaidSource);at(t,"Mermaid",n)}),Nn();return}if(!ht){try{mermaid.initialize({startOnLoad:!1,theme:"dark",securityLevel:"loose"})}catch(t){console.warn("Mermaid initialization issue",t)}ht=!0}e.forEach((t,n)=>{let i=Bt(t.dataset.mermaidSource);if(!i.trim()){_(t,"Mermaid","Diagram source is empty",i);return}let r=`${t.id||"mermaid-diagram"}-${n}`;mermaid.render(r,i).then(({svg:o})=>{t.innerHTML=o}).catch(o=>{console.error("Mermaid rendering error",o),_(t,"Mermaid",o.message,i)})})}}function Ht(){let e=v.querySelectorAll(".vega-diagram[data-vega-source]");if(e.length){if(typeof vegaEmbed=="undefined"){e.forEach(t=>{let n=It(t.dataset.vegaSource);at(t,"Vega",n)}),Hn();return}e.forEach(t=>{let n=It(t.dataset.vegaSource);if(!n.trim()){_(t,"Vega","Specification is empty",n);return}let i;try{i=JSON.parse(n)}catch(r){console.error("Vega parsing error",r),_(t,"Vega","Invalid Vega/Vega-Lite specification",n);return}t.innerHTML="",vegaEmbed(t,i,{actions:!1,renderer:"canvas",theme:"dark"}).catch(r=>{console.error("Vega rendering error",r),_(t,"Vega",r.message,n)})})}}function Ot(){let e=v.querySelectorAll(".excalidraw-diagram[data-excalidraw-source]");if(e.length){if(!window.React||!window.ReactDOM||!window.ExcalidrawLib||!window.ExcalidrawLib.Excalidraw){e.forEach(t=>{let n=Dt(t.dataset.excalidrawSource);at(t,"Excalidraw",n)}),On();return}e.forEach(t=>{let n=Dt(t.dataset.excalidrawSource);if(!n.trim()){_(t,"Excalidraw","Scene data is empty",n);return}let i;try{i=JSON.parse(n)}catch(l){console.error("Excalidraw parsing error",l),_(t,"Excalidraw","Invalid scene JSON",n);return}i={...i,appState:{...i&&typeof i=="object"&&i.appState?i.appState:{},viewBackgroundColor:"transparent"}};let o=re.get(t);if(o&&typeof o.unmount=="function")try{o.unmount()}catch(l){console.warn("Failed to unmount previous Excalidraw root",l)}re.delete(t),t.innerHTML="";let a=document.createElement("div");a.className="excalidraw-wrapper",a.tabIndex=-1,t.appendChild(a);let s={root:null,api:null,wrapper:a,unmount(){if(s.api=null,s.root&&typeof s.root.unmount=="function")s.root.unmount();else if(typeof window.ReactDOM!="undefined"&&typeof window.ReactDOM.unmountComponentAtNode=="function")try{window.ReactDOM.unmountComponentAtNode(a)}catch(l){console.warn("Failed to unmount Excalidraw instance",l)}}};try{let l=Bn(),u=window.React.createElement(window.ExcalidrawLib.Excalidraw,{initialData:i,viewModeEnabled:!0,zenModeEnabled:!1,gridModeEnabled:!1,theme:"dark",autoFocus:!1,UIOptions:l,handleKeyboardEvent:()=>!1,ref:f=>{s.api=f||null,f&&(Ke=!1,Un(),st(f),typeof window!="undefined"&&typeof window.setTimeout=="function"&&window.setTimeout(()=>st(f),250))}}),d;if(typeof window.ReactDOM.createRoot=="function")d=window.ReactDOM.createRoot(a),d.render(u);else if(typeof window.ReactDOM.render=="function")window.ReactDOM.render(u,a),d={unmount(){typeof window.ReactDOM.unmountComponentAtNode=="function"&&window.ReactDOM.unmountComponentAtNode(a)}};else throw new Error("ReactDOM renderer is unavailable");s.root=d,re.set(t,s)}catch(l){s.api=null,console.error("Excalidraw rendering error",l),_(t,"Excalidraw",l.message,n)}})}}function zn(){Nt(),Ht(),Ot()}function oi(e){}function Vt(e){en.classList.toggle("visible",!e)}function ce(e){let t=!!e;t!==ie&&(ie=t,document.body.classList.toggle("document-has-pending-changes",ie),E())}function _n(){var r;let e=(r=m==null?void 0:m.panels)==null?void 0:r.viewer;if(!e)return;let t=c||"Document",n=ie&&c?`${t} \u25CF`:t,i=e==null?void 0:e.api;i&&typeof i.setTitle=="function"?i.setTitle(n):typeof e.setTitle=="function"&&e.setTitle(n)}function qn(e={}){if(!M)return Promise.resolve("cancel");if(Ae)return Ae;let t=typeof e.nextFile=="string"?e.nextFile:"",n=c||"this document";lt&&(lt.textContent=n),ct&&ct.setAttribute("data-current-file",n),_e&&(t&&t!==c?_e.textContent=`Switch to \u201C${t}\u201D without saving?`:_e.textContent="What would you like to do?"),M.classList.add("visible"),document.body.classList.add("modal-open");let i=new Promise(r=>{let o=()=>{M.classList.remove("visible"),document.body.classList.remove("modal-open"),O&&O.removeEventListener("click",s),V&&V.removeEventListener("click",l),Se&&Se.removeEventListener("click",u),M.removeEventListener("keydown",d,!0),M.removeEventListener("click",f),Ae=null},a=w=>{o(),r(w)},s=()=>a("save"),l=()=>a("discard"),u=()=>a("cancel"),d=w=>{w.key==="Escape"&&(w.preventDefault(),a("cancel"))},f=w=>{w.target===M&&a("cancel")};O&&O.addEventListener("click",s),V&&V.addEventListener("click",l),Se&&Se.addEventListener("click",u),M.addEventListener("keydown",d,!0),M.addEventListener("click",f),window.setTimeout(()=>{typeof(O==null?void 0:O.focus)=="function"?O.focus():typeof(V==null?void 0:V.focus)=="function"?V.focus():M.focus({preventScroll:!0})},0)});return Ae=i,i}function E(){let e=!!c,t=ie&&e?" \u25CF":"";if(J)if(be)e?(J.textContent=`Markdown Viewer${t}`,J.classList.add("hidden")):(J.textContent="No file selected",J.classList.remove("hidden"));else{J.classList.remove("hidden");let n=e?c:"No file selected";J.textContent=e?`${n}${t}`:n}Xt.textContent=C||z||"Unknown",Ne.disabled=!e,He.disabled=!e,Oe.disabled=!e&&!h,Ve.disabled=!e,Ue.disabled=!e,ze.disabled=!1,Ut(),_n()}function Ut(){let e=!!c;Oe.classList.toggle("hidden",!e||h&&!b),Ve.classList.toggle("hidden",!h||b),Ue.classList.toggle("hidden",!h),ze.classList.toggle("hidden",!h),Ne.classList.toggle("hidden",h),He.classList.toggle("hidden",h)}function G(e){let t=new URLSearchParams;z&&t.set("path",z),Object.entries(e).forEach(([i,r])=>{r!=null&&r!==""&&t.set(i,r)});let n=t.toString();return n?`?${n}`:""}function Be(e,{replace:t=!1}={}){let n=G({file:e}),i=`${window.location.pathname}${n}`,r=`${window.location.pathname}${window.location.search}`,o={file:e};t||i===r?window.history.replaceState(o,"",i):window.history.pushState(o,"",i)}function zt(e){let n=new URLSearchParams(e||"").get("file");if(typeof n!="string")return"";let i=n.trim();return i===""?"":i}function H(e,t={}){Rn(),Ln(),yn(c),wt=0,yt=0,vt=0,oe=new Map;let n=e||"",i=!!t.updateCurrent;if(Pt(n),typeof marked=="undefined"){W=null,he=n,v.textContent=n,_t([]),In().then(()=>{if(he!==null){let o=he;he=null,H(o,{updateCurrent:i})}}),i&&($=n);return}W=[],v.innerHTML=marked.parse(n);let r=Array.isArray(W)?[...W]:[];W=null,he=null,typeof hljs!="undefined"&&v.querySelectorAll("pre code").forEach(o=>{if(!o.closest(".mermaid, .vega-diagram, .excalidraw-diagram"))try{hljs.highlightElement(o)}catch(a){console.warn("Highlight.js error",a)}}),_t(r),zn(),i&&($=n)}function _t(e){if(!ee)return;if(ee.innerHTML="",!Array.isArray(e)||e.length===0){let i=document.createElement("p");i.className="toc-empty-state",i.textContent="No headings found in this document yet.",ee.appendChild(i);return}let t=e.reduce((i,r)=>{let o=typeof r.level=="number"?r.level:1;return Math.min(i,Math.max(1,Math.min(6,o)))},6),n=document.createElement("ol");n.setAttribute("role","list"),e.forEach(i=>{let r=Math.max(1,Math.min(6,i.level||1)),o=document.createElement("li");o.className="toc-entry";let a=document.createElement("a");a.className="toc-link",a.href=`#${i.slug}`,a.textContent=i.text||i.slug||"Untitled section",a.setAttribute("aria-level",String(r)),a.dataset.level=String(r);let s=Math.max(0,r-t);a.style.paddingLeft=`${10+s*16}px`,o.appendChild(a),n.appendChild(o)}),ee.appendChild(n)}function jn(e){let t=e.target.closest("a.toc-link");if(!t)return;let n=t.getAttribute("href");if(typeof n!="string"||!n.startsWith("#"))return;let i=n.slice(1);if(!i)return;let r=document.getElementById(i);if(r){e.preventDefault();try{r.scrollIntoView({behavior:"smooth",block:"start"})}catch(o){r.scrollIntoView()}if(typeof history!="undefined"&&typeof history.replaceState=="function"){let o=`${window.location.pathname}${window.location.search}#${i}`;history.replaceState(history.state,"",o)}}}ee&&ee.addEventListener("click",jn);function Q(){if(U)return U;if(typeof window.CodeMirror=="undefined")return null;X.innerHTML="",ge=!0;try{U=window.CodeMirror(X,{value:L,mode:"markdown",theme:"one-dark",lineNumbers:!0,lineWrapping:!0,autofocus:!0}),U.setSize("100%","100%"),U.on("change",Jn)}finally{ge=!1}return ce(L!==$),U}function Jn(e){!e||ge||(L=e.getValue(),ce(L!==$))}function qt(){if(!c)return;if(typeof window.CodeMirror=="undefined"){return}h=!0,b=!1,L=$;let e=Q();if(!e){h=!1,Ut();return}ge=!0;try{e.setValue(L)}finally{ge=!1}ce(!1),window.setTimeout(()=>{e.refresh(),e.focus()},0),v.classList.add("hidden"),X.classList.add("visible"),E()}function Wn(){if(!h)return;let e=Q();e&&(L=e.getValue()),ce(L!==$),b=!0,H(L,{updateCurrent:!1}),X.classList.remove("visible"),v.classList.remove("hidden"),E()}function jt(){if(!b)return;b=!1,H($,{updateCurrent:!0}),v.classList.add("hidden"),X.classList.add("visible");let e=Q();e&&window.setTimeout(()=>{e.refresh(),e.focus()},0),E()}function q(e={}){let{restoreContent:t=!0}=e;if(!h&&!b){E();return}h=!1,b=!1,L="",xn(),v.classList.remove("hidden"),X.classList.remove("visible"),t&&H($,{updateCurrent:!0}),ce(!1),E()}function Yn(e={}){let{skipHistory:t=!1}=e;q({restoreContent:!1}),c=null;let n=De(C||z||"the selected path");H(n,{updateCurrent:!0}),de(),E(),t||Be("",{replace:!0})}function Ie(){xe.innerHTML="";let e=Array.isArray(pe)&&pe.length?pe:xt(k);if(!e.length){let r=document.createElement("li");r.className="empty-state",r.textContent="No markdown files yet",xe.appendChild(r);return}Gn(c);let t=new Set,n=document.createDocumentFragment();e.forEach(r=>{n.appendChild(Jt(r,0,t))}),xe.appendChild(n);let i=[];R.forEach(r=>{t.has(r)||i.push(r)}),i.forEach(r=>R.delete(r)),et.clear(),t.forEach(r=>et.add(r)),de()}function Jt(e,t,n){let i=document.createElement("li");if(i.className=`tree-node ${e.type==="directory"?"directory-node":"file-node"}`,e.type==="directory"){let s=typeof e.relativePath=="string"?e.relativePath:"";n.add(s),!et.has(s)&&!R.has(s)&&R.add(s);let l=document.createElement("div");l.className="tree-row directory-row",l.style.paddingLeft=`${t*16}px`;let u=R.has(s),d=document.createElement("button");d.type="button",d.className="tree-toggle",d.setAttribute("aria-expanded",String(u)),d.setAttribute("aria-label",`${u?"Collapse":"Expand"} ${e.name}`),d.textContent=u?"\u25BE":"\u25B8",d.addEventListener("click",ue=>{ue.preventDefault(),ue.stopPropagation(),Wt(s)});let f=document.createElement("button");f.type="button",f.className="tree-label directory-label";let w=document.createElement("i");w.className=u?"directory-icon fas fa-folder-open":"directory-icon fas fa-folder";let S=document.createElement("span");S.textContent=e.name,f.appendChild(w),f.appendChild(S),f.addEventListener("click",ue=>{ue.preventDefault(),Wt(s)}),l.appendChild(d),l.appendChild(f),i.appendChild(l);let Re=document.createElement("ul");return Re.className="tree-children",u||Re.classList.add("collapsed"),(Array.isArray(e.children)?e.children:[]).forEach(ue=>{Re.appendChild(Jt(ue,t+1,n))}),i.appendChild(Re),i}let r=document.createElement("button");r.className="file-button",r.type="button";let o=document.createElement("i");o.className="file-icon fab fa-markdown";let a=document.createElement("span");return a.textContent=e.name,r.appendChild(o),r.appendChild(a),r.dataset.file=e.relativePath,r.style.paddingLeft=`${t*16+24}px`,r.addEventListener("click",()=>{e.relativePath!==c&&Zn(e.relativePath)}),i.appendChild(r),i}function Gn(e){if(typeof e!="string"||!e.includes("/"))return;let t=e.split("/");t.pop();let n="";t.forEach(i=>{i&&(n=n?`${n}/${i}`:i,R.add(n))})}function Wt(e){!e&&e!==""||(R.has(e)?R.delete(e):R.add(e),Ie())}function de(){xe.querySelectorAll(".file-button").forEach(e=>{e.classList.toggle("active",e.dataset.file===c)})}async function Le(e,t){let n=await fetch(e,t);if(!n.ok){let i=await n.text();throw new Error(i||`Request failed with status ${n.status}`)}return n.json()}async function Qn(){let e=`/api/files${G({})}`,t=await Le(e);C=t.rootPath||C;let n=it({filesValue:t.files,treeValue:t.tree});k=n.files,pe=n.tree,Ie(),k.find(i=>i.relativePath===c)?(de(),E()):(c=k.length?k[0].relativePath:null,c?await Z(c,{replaceHistory:!0}):(c=null,q({restoreContent:!1}),H(De(C||z||"the selected path"),{updateCurrent:!0}),Be("",{replace:!0}),E()))}function De(e){return`# No markdown files found

The directory \`${e}\` does not contain any markdown files yet.`}async function Z(e,t={}){let{skipHistory:n=!1,replaceHistory:i=!1}=t;h||b?q():void 0;let r=`/api/file${G({file:e})}`;try{let o=await Le(r);C=o.rootPath||C,c=o.file||e,H(o.content||"",{updateCurrent:!0}),ce(!1),de(),E(),Be(c,{replace:i||n})}catch(o){o.message,console.error("Failed to load file",o)}}async function Yt(){if(!h||!c)return!1;let e=Q();e&&!b&&(L=e.getValue());let t=L;try{return await Le(`/api/file${G({file:c})}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:t})}),$=t,q(),de(),!0}catch(n){return n.message,console.error("Save failed",n),!1}}async function Zn(e){if(ie){let t=await qn({nextFile:e});if(t==="cancel")return;if(t==="save"){if(!await Yt())return}else t==="discard"&&(q(),void 0)}else(h||b)&&q();await Z(e)}function Kn(){Oe.addEventListener("click",()=>{if(h&&b){jt();return}h||qt()}),Ve.addEventListener("click",()=>{c&&Wn()}),ze.addEventListener("click",()=>{!h&&!b||(q(),void 0)}),Ue.addEventListener("click",async()=>{await Yt()}),Ne.addEventListener("click",async()=>{if(c)try{let e=await Le(`/api/file${G({file:c})}`),t=new Blob([e.content||""],{type:"text/markdown"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download=c,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}catch(e){e.message,console.error("Download failed",e)}}),He.addEventListener("click",async()=>{if(!(!c||!window.confirm(`Delete ${c}?`)))try{await Le(`/api/file${G({file:c})}`,{method:"DELETE"}),await Qn()}catch(t){t.message,console.error("Delete failed",t)}})}function Gt(){D&&D.close();let e=window.location.protocol==="https:"?"wss":"ws";D=new WebSocket(`${e}://${window.location.host}/ws`),D.addEventListener("open",()=>{Vt(!0),D.send(JSON.stringify({type:"subscribe",path:z}))}),D.addEventListener("message",async n=>{try{let i=JSON.parse(n.data);if(i.type==="directory_update"){C=i.path||C;let r=it({filesValue:i.files,treeValue:i.tree});k=r.files,pe=r.tree,Ie(),k.find(o=>o.relativePath===c)?(de(),E()):(c=k.length?k[0].relativePath:null,c?await Z(c,{replaceHistory:!0}):(c=null,q({restoreContent:!1}),H(De(C||z||"the selected path"),{updateCurrent:!0}),Be("",{replace:!0}),E()))}else i.type==="file_changed"&&i.file&&i.file===c&&await Z(c,{replaceHistory:!0})}catch(i){console.error("Failed to process websocket event",i)}});function t(){We||(We=window.setTimeout(()=>{We=null,Gt()},1500))}D.addEventListener("close",()=>{Vt(!1),t()}),D.addEventListener("error",()=>{D.close()})}function Qt(){tt||(tt=window.setTimeout(()=>{tt=null,p||ke(),y||Ce()},250))}function Xn(){return typeof window!="undefined"&&typeof window.Terminal=="function"&&window.FitAddon&&typeof window.FitAddon.FitAddon=="function"}function ke(){if(p||!qe)return p;if(!Xn())return Qt(),null;try{p=new window.Terminal({convertEol:!0,cursorBlink:!0,fontFamily:'Menlo, Monaco, "Courier New", monospace',fontSize:13,theme:{background:"#21252b",foreground:"#abb2bf",cursor:"#abb2bf",cursorAccent:"#21252b",selection:"#323844",selectionForeground:"#abb2bf",black:"#21252b",red:"#e06c75",green:"#98c379",yellow:"#e5c07b",blue:"#61afef",magenta:"#c678dd",cyan:"#56b6c2",white:"#abb2bf",brightBlack:"#767676",brightRed:"#e06c75",brightGreen:"#98c379",brightYellow:"#e5c07b",brightBlue:"#61afef",brightMagenta:"#c678dd",brightCyan:"#56b6c2",brightWhite:"#abb2bf"}})}catch(e){return console.warn("Failed to initialise terminal instance",e),p=null,null}try{Ee=new window.FitAddon.FitAddon,p.loadAddon(Ee)}catch(e){return console.warn("Failed to load terminal fit addon",e),p.dispose(),p=null,null}return p.open(qe),p.focus(),p.onData(e=>{y&&y.readyState===WebSocket.OPEN&&y.send(JSON.stringify({type:"input",data:e}))}),p.onResize(e=>{y&&y.readyState===WebSocket.OPEN&&y.send(JSON.stringify({type:"resize",cols:e.cols,rows:e.rows}))}),j(),p}function j(){!p||!Ee||A||(Fe&&window.cancelAnimationFrame(Fe),Fe=window.requestAnimationFrame(()=>{Fe=null,ei()}))}function ei(){if(!(!p||!Ee||A)){try{Ee.fit()}catch(e){console.warn("Unable to fit terminal to container",e);return}ti()}}function ti(){!p||!y||y.readyState!==WebSocket.OPEN||y.send(JSON.stringify({type:"resize",cols:p.cols,rows:p.rows}))}function K(e){ft&&(ft.textContent=e||""),Lt=e||""}function Zt(e=1500){ae||(ae=window.setTimeout(()=>{ae=null,Ce()},e))}function Ce(){if(!qe||y&&(y.readyState===WebSocket.OPEN||y.readyState===WebSocket.CONNECTING))return;if(!ke()){Qt();return}let t=window.location.protocol==="https:"?"wss":"ws",n=new WebSocket(`${t}://${window.location.host}/ws/terminal`);n.binaryType="arraybuffer",y=n,K("Connecting\u2026"),n.addEventListener("open",()=>{ae&&(window.clearTimeout(ae),ae=null),K("Connected"),j()}),n.addEventListener("message",i=>{if(!p)return;if(typeof i.data=="string"){try{let o=JSON.parse(i.data);if(o.type==="state"&&typeof o.message=="string"){K(o.message);return}if(o.type==="exit"){typeof o.code=="number"?K(`Process exited (${o.code})`):K("Process exited"),Zt();return}}catch(o){p.write(i.data);return}p.write(i.data);return}let r=o=>{if(!o)return;let a=cn.decode(o);a&&p.write(a)};if(i.data instanceof ArrayBuffer){r(new Uint8Array(i.data));return}i.data&&typeof i.data.arrayBuffer=="function"&&i.data.arrayBuffer().then(o=>r(new Uint8Array(o))).catch(o=>console.warn("Failed to decode terminal payload",o))}),n.addEventListener("close",()=>{y=null,Lt.startsWith("Process exited")||K("Disconnected \u2013 reconnecting\u2026"),Zt()}),n.addEventListener("error",()=>{K("Connection error"),n.close()})}function ni(){if(!g)return;if(!be&&se&&(se.disconnect(),se=null),be){if(A=!1,g.style.height="",g.style.maxHeight="",g.classList.remove("is-collapsed"),ne&&ne.remove(),I&&(I.disabled=!0,I.textContent="Terminal (layout-managed)",I.setAttribute("aria-expanded","true")),!se&&typeof window.ResizeObserver=="function"){let s=g.parentElement||g;s&&(se=new window.ResizeObserver(()=>{j()}),se.observe(s))}ke()&&j(),Ce();return}let e=140,t=a=>{let s=Math.max(e,Math.round(window.innerHeight*.75));return Number.isFinite(a)?Math.min(Math.max(a,e),s):e},n=()=>{if(typeof window.localStorage!="undefined")try{window.localStorage.setItem(mt,String(Y))}catch(a){}},i=(a,{persist:s=!1}={})=>{let l=t(a);return Y=l,g.style.height=`${l}px`,s&&n(),j(),l},r=()=>{if(typeof window.localStorage=="undefined"){Y=t(g.getBoundingClientRect().height||260);return}let a=null;try{a=window.localStorage.getItem(mt)}catch(l){a=null}let s=a===null?NaN:Number(a);Number.isFinite(s)?i(s):Y=t(g.getBoundingClientRect().height||260)},o=a=>{let s=!!a;if(A===s)return;if(A=s,g.classList.toggle("is-collapsed",s),I&&(I.setAttribute("aria-expanded",String(!s)),I.textContent=s?"Show terminal":"Hide terminal"),s){g.style.height="";return}if(i(Y||t(g.getBoundingClientRect().height||260)),g){let u=d=>{d.target!==g||d.propertyName!=="height"||(g.removeEventListener("transitionend",u),j())};g.addEventListener("transitionend",u,{once:!0})}let l=ke();l&&(l.focus(),typeof l.scrollToBottom=="function"&&l.scrollToBottom()),Ce()};r(),I&&I.addEventListener("click",()=>{o(!A)}),ne&&(ne.addEventListener("pointerdown",a=>{if(a.button!==0)return;A&&o(!1),a.preventDefault();let s=a.clientY,l=g.getBoundingClientRect().height,u=f=>{let w=s-f.clientY,S=t(l+w);i(S)},d=()=>{document.removeEventListener("pointermove",u),document.removeEventListener("pointerup",d),n(),j()};document.addEventListener("pointermove",u),document.addEventListener("pointerup",d)}),ne.addEventListener("keydown",a=>{if(a.key!=="ArrowUp"&&a.key!=="ArrowDown")return;a.preventDefault(),A&&o(!1);let s=a.key==="ArrowUp"?32:-32,l=t((Y||g.getBoundingClientRect().height)+s);i(l,{persist:!0})}),ne.addEventListener("dblclick",()=>{A&&o(!1),i(t(260),{persist:!0})})),window.addEventListener("resize",()=>{if(A)return;let a=Y||g.getBoundingClientRect().height,s=t(a);s!==a?i(s,{persist:!0}):j()}),o(!1),ke(),Ce()}window.addEventListener("beforeunload",()=>{if(y&&y.readyState===WebSocket.OPEN)try{y.close()}catch(e){}});function ii(){let e=De(C||z||"the selected path");H(T.content||e,{updateCurrent:!0}),Ie(),E(),T.error&&(T.error,void 0),Kn(),ni(),Gt(),!c&&k.length&&(c=k[0].relativePath),!Ye&&c&&Z(c,{replaceHistory:!0})}window.addEventListener("popstate",()=>{let e=zt(window.location.search);e?e!==c&&Z(e,{skipHistory:!0,replaceHistory:!0}):Yn({skipHistory:!0})}),ii(),Ye&&Z(Ye,{replaceHistory:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Kt,{once:!0}):Kt();})();
//# sourceMappingURL=unified_index.js.map
